"use strict";(self.webpackChunkgrain_voucher_system=self.webpackChunkgrain_voucher_system||[]).push([[1569],{683:(e,t,a)=>{var r=a(24994);t.A=void 0;var s=r(a(40039)),i=a(70579);t.A=(0,s.default)((0,i.jsx)("path",{d:"M14 10H3v2h11zm0-4H3v2h11zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2zM3 16h7v-2H3z"}),"PlaylistAdd")},13194:(e,t,a)=>{a.d(t,{A:()=>i});var r=a(65043),s=a(95926);const i=e=>{const{title:t,setTitle:a}=(0,r.useContext)(s.C);return(0,r.useEffect)((()=>a(e)),[e,a]),t}},15238:(e,t,a)=>{a.d(t,{D:()=>s});var r=a(56629);const s={getUsers:async e=>r.A.get("auth/users/",{params:e}).then((e=>e.data)),getAvailableFarmers:async e=>r.A.get("vouchers/deposits/available_farmers",{params:e}).then((e=>e.data)),createUser:async e=>r.A.post("auth/users/",e).then((e=>e.data)),getUserDetails:async e=>r.A.get("auth/users/".concat(e,"/")).then((e=>e.data)),updateUser:async(e,t)=>r.A.patch("auth/users/".concat(t,"/"),e).then((e=>e.data)),deactivateUser:async e=>r.A.delete("auth/users/".concat(e,"/")).then((e=>e.data))}},23722:(e,t,a)=>{a.d(t,{A:()=>n});var r=a(89379),s=(a(65043),a(67024)),i=a(81637),o=a(70579);const n=e=>{let{size:t,color:a="primary",sx:n}=e;return(0,o.jsx)(s.A,{sx:(0,r.A)({color:"grey.500"},n),spacing:2,direction:"row",children:(0,o.jsx)(i.A,{size:t,color:a})})}},23817:(e,t,a)=>{a.d(t,{A:()=>c});var r=a(65043),s=a(17392),i=a(688),o=a(32143),n=a(42438),l=a(98082),d=a(70579);const c=e=>{let{actions:t,metaData:a,btnColor:c}=e;const[p,u]=(0,r.useState)(null),m=()=>{u(null)},h=t.filter((e=>!e.condition||e.condition(a)));return 0===h.length?null:(0,d.jsxs)("div",{children:[(0,d.jsx)(s.A,{size:"small",onClick:e=>{u(e.currentTarget)},children:(0,d.jsx)(l.A,{fontSize:"small"})}),(0,d.jsx)(i.A,{anchorEl:p,open:Boolean(p),onClose:m,children:h.map(((e,t)=>(0,d.jsxs)(o.A,{onClick:()=>(e=>{e.onClick(a),m()})(e),children:[e.icon,(0,d.jsx)(n.L9,{sx:{marginLeft:"0.5rem"},children:e.label})]},t)))})]})}},46055:(e,t,a)=>{a.d(t,{pU:()=>r});const r=e=>{if(!e)return"N/A";const t=new Date(e);if(isNaN(t.getTime()))return"Invalid Date";const a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getFullYear();return"".concat(a,"/").concat(r,"/").concat(s)}},49250:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(89379),s=a(8122),i=a(70579);const o=e=>(0,i.jsxs)(s.A,(0,r.A)((0,r.A)({viewBox:"0 0 20 20"},e),{},{children:[(0,i.jsx)("path",{d:"M8.80758 0C3.95121 0 0 3.95121 0 8.80758C0 13.6642 3.95121 17.6152 8.80758 17.6152C13.6642 17.6152 17.6152 13.6642 17.6152 8.80758C17.6152 3.95121 13.6642 0 8.80758 0ZM8.80758 15.9892C4.84769 15.9892 1.62602 12.7675 1.62602 8.80762C1.62602 4.84773 4.84769 1.62602 8.80758 1.62602C12.7675 1.62602 15.9891 4.84769 15.9891 8.80758C15.9891 12.7675 12.7675 15.9892 8.80758 15.9892Z",fill:"currentColor"}),(0,i.jsx)("path",{d:"M19.7617 18.6124L15.1005 13.9511C14.7829 13.6335 14.2685 13.6335 13.9509 13.9511C13.6332 14.2684 13.6332 14.7834 13.9509 15.1007L18.6121 19.762C18.7709 19.9208 18.9788 20.0002 19.1869 20.0002C19.3948 20.0002 19.6029 19.9208 19.7617 19.762C20.0794 19.4446 20.0794 18.9297 19.7617 18.6124Z",fill:"currentColor"})]}))},61408:(e,t,a)=>{a.d(t,{A:()=>k});var r=a(89379),s=a(14126),i=a(34535),o=a(59135),n=a(26240),l=a(96446),d=a(71806),c=a(84882),p=a(28076),u=a(10039),m=a(73460),h=a(67024),y=a(72949),x=a(65043),g=a(71094),A=a(6905),v=a(42438),f=a(70579);const j=e=>{let{message:t}=e;return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(l.A,{sx:{width:"100%",color:"text.disabled"},children:(0,f.jsx)("p",{className:"font13",style:{fontWeight:500,color:"text.disabled"},children:t})})})};var b=a(32513),C=a(55935);const S=(0,i.Ay)(o.A)((e=>{let{theme:t}=e;return{"& .MuiPaginationItem-root":{fontSize:12,fontWeight:500,color:t.palette.text.disabled},"& .MuiPaginationItem-page:hover":{borderRadius:20,backgroundColor:"transparent",color:t.palette.primary.main,border:"1px solid ".concat(t.palette.primary.main)},"& .MuiPaginationItem-page.Mui-selected":{borderRadius:20,backgroundColor:"transparent",color:t.palette.primary.main,border:"1px solid ".concat(t.palette.primary.main)},"& .MuiPaginationItem-previousNext":{margin:10,borderRadius:20,color:t.palette.primary.main,border:"1px solid ".concat(t.palette.primary.main),"&:hover":{backgroundColor:"transparent"}}}})),k=e=>{const{data:t,rowClick:a,showFooter:i,columnShape:o,hidePagination:k=!1,dataCount:w,pageInitialState:P,setPageIndex:z,pageIndex:E,loading:W}=e,_=(0,n.A)(),M=(0,x.useMemo)((()=>t),[t]),R=(0,x.useMemo)((()=>o),[o]),B=(0,x.useMemo)((()=>P),[P]),{getTableProps:T,getTableBodyProps:D,headerGroups:L,prepareRow:U,page:I,state:{pageSize:H},setPageSize:F}=(0,g.useTable)({columns:R,data:M,initialState:B},g.useSortBy,g.useExpanded,g.usePagination,g.useRowSelect);return(0,x.useEffect)((()=>{F(P.pageSize)}),[P,F]),(0,f.jsxs)(l.A,{children:[(0,f.jsx)("div",{className:"table-responsive whiteBg",style:{borderRadius:10,border:"1px solid #eee"},children:(0,f.jsxs)(d.A,(0,r.A)((0,r.A)({},T()),{},{sx:{borderSpacing:"0 0.2rem",borderCollapse:"separate"},children:[(0,f.jsx)(c.A,{children:L.map((e=>(0,f.jsxs)(p.A,(0,r.A)((0,r.A)({},e.getHeaderGroupProps()),{},{children:[(0,f.jsx)(u.A,{sx:{paddingY:1,fontSize:13,width:10},children:"#"}),e.headers.map((e=>(0,f.jsx)(u.A,(0,r.A)((0,r.A)({},e.getHeaderProps(e.getSortByToggleProps())),{},{sx:{paddingY:0,fontSize:13,fontWeight:600,color:"text.black",width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth,"&:last-child":{textAlign:"center"}},children:e.render("Header")}))))]}))))}),(0,f.jsx)(m.A,(0,r.A)((0,r.A)({},D()),{},{children:W?(0,f.jsx)(p.A,{children:(0,f.jsx)(u.A,{colSpan:R.length+1,sx:{textAlign:"left"},children:(0,f.jsx)(b.a,{})})}):I.length>0?I.map(((e,t)=>{var s;return U(e),(0,f.jsxs)(p.A,(0,r.A)((0,r.A)({},e.getRowProps()),{},{onClick:a&&a(e.original),sx:{backgroundColor:null!==(s=e.original)&&void 0!==s&&s.has_error?"pink":1&t?"background.paper":C.j3,borderTop:"1.5px solid ".concat(C.j3),cursor:a?"pointer":"unset","& td:first-of-type":{},"& td:last-of-type":{textAlign:"center"},"&:last-of-type .MuiTableCell-root":{borderBottom:"dark"===_.palette.mode?"1px solid ".concat(_.palette.divider," !important"):"1px solid ".concat(_.palette.text.secondary," !important")},borderSpacing:5},children:[(0,f.jsx)(u.A,{sx:{fontSize:12,fontWeight:500,paddingY:1.2,color:"text.black","&:last-of-type div.css-o3rlxk":{display:"flex",justifyContent:"center"}},children:100*((E||1)-1)+t+1}),e.cells.map((e=>(0,f.jsx)(u.A,(0,r.A)((0,r.A)({},e.getCellProps()),{},{sx:{fontSize:12,fontWeight:500,paddingY:1.2,color:"text.black","&:last-of-type div.css-o3rlxk":{display:"flex",justifyContent:"center"}},children:null===e||void 0===e?void 0:e.render("Cell")}))))]}))})):(0,f.jsx)(p.A,{sx:{borderBottomWidth:0,borderColor:"white"},children:(0,f.jsx)(u.A,{colSpan:R.length+1,sx:{textAlign:"center"},children:(0,f.jsx)(j,{message:"No Data Available"})})})}))]}))}),!k&&(0,f.jsx)(h.A,{alignItems:"flex-end",marginY:1,children:(0,f.jsx)(S,{count:Math.ceil(w/H),shape:"rounded",page:E,onChange:(e,t)=>{z(t)}})}),i&&(0,f.jsxs)(A.A,{alignItems:"center",justifyContent:"space-between",children:[(0,f.jsx)(v.H5,{color:"text.disabled",children:"Showing 1-12 of 24 result"}),(0,f.jsxs)(y.A,{disableRipple:!0,sx:{fontSize:14,fontWeight:600},children:["See All",(0,f.jsx)(s.A,{sx:{marginLeft:.5}})]})]})]})}},61569:(e,t,a)=>{a.r(t),a.d(t,{default:()=>K});var r=a(89379),s=a(96446),i=a(8302),o=a(14912),n=a(24056),l=a(85865),d=a(65043),c=a(23768),p=a(63471),u=a(95540),m=a(683),h=a(13194),y=a(8433),x=a(56629);const g={getEmployees:async e=>x.A.get("payroll/employees/",{params:e}).then((e=>e.data)),createEmployee:async e=>x.A.post("payroll/employees/",e).then((e=>e.data)),getEmployeeDetails:async e=>x.A.get("payroll/employees/".concat(e,"/")).then((e=>e.data)),updateEmployee:async(e,t)=>x.A.patch("payroll/employees/".concat(t,"/"),e).then((e=>e.data)),deleteEmployee:async e=>x.A.delete("payroll/employees/".concat(e,"/")).then((e=>e.data)),getPayslips:async e=>x.A.get("payroll/payslips/",{params:e}).then((e=>e.data)),createPayslip:async e=>x.A.post("payroll/payslips/",e).then((e=>e.data)),getPayslipDetails:async e=>x.A.get("payroll/payslips/".concat(e,"/")).then((e=>e.data)),updatePayslip:async(e,t)=>x.A.patch("payroll/payslips/".concat(t,"/"),e).then((e=>e.data)),deletePayslip:async e=>x.A.delete("payroll/payslips/".concat(e,"/")).then((e=>e.data)),generateMonthlyPayslips:async e=>x.A.post("payroll/payslips/generate_monthly/",{period:e}).then((e=>e.data))};var A=a(81637),v=a(67784),f=a(35721),j=a(30681),b=a(48734),C=a(74523),S=a(42438),k=a(75992),w=a(70579);const P=e=>{let{handleClose:t,callBack:a}=e;const[r,o]=(0,d.useState)(!1),[n,p]=(0,d.useState)((new Date).toISOString().slice(0,7)),u=async()=>{if(n){o(!0);try{await g.generateMonthlyPayslips(n),c.oR.success("Payslip generation initiated successfully"),a&&a(),t(),o(!1)}catch(e){o(!1),c.oR.error(e.message||"Failed to generate payslips")}}else c.oR.error("Please select a period")},m=()=>{p((new Date).toISOString().slice(0,7)),t()};return(0,w.jsx)(C.A,{title:"Generate Monthly Payslips",onClose:m,id:(0,k.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.A,{onClick:m,disabled:r,children:"Cancel"}),(0,w.jsx)(i.A,{onClick:u,variant:"contained",disabled:r||!n,children:r?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(A.A,{color:"inherit",size:20})," ",(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Generating..."})]}):"Generate Payslips"})]}),children:(0,w.jsxs)(s.A,{sx:{width:"100%",minWidth:400},children:[(0,w.jsx)(l.A,{variant:"body1",sx:{mb:2},children:"Generate payslips for all employees for the selected period."}),(0,w.jsx)(v.A,{fullWidth:!0,label:"Payroll Period",type:"month",value:n,onChange:e=>p(e.target.value),InputLabelProps:{shrink:!0},sx:{mb:3}}),(0,w.jsxs)(s.A,{sx:{bgcolor:"grey.50",p:2,borderRadius:1,mb:2},children:[(0,w.jsx)(l.A,{variant:"subtitle2",color:"primary",sx:{mb:1},children:"What this will do:"}),(0,w.jsxs)(f.A,{dense:!0,children:[(0,w.jsx)(j.Ay,{sx:{py:.5},children:(0,w.jsx)(b.A,{primary:"\u2022 Generate payslips for all active employees",primaryTypographyProps:{variant:"body2"}})}),(0,w.jsx)(j.Ay,{sx:{py:.5},children:(0,w.jsx)(b.A,{primary:"\u2022 Use employee base salary as gross earnings",primaryTypographyProps:{variant:"body2"}})}),(0,w.jsx)(j.Ay,{sx:{py:.5},children:(0,w.jsx)(b.A,{primary:"\u2022 Apply default deductions (if configured)",primaryTypographyProps:{variant:"body2"}})}),(0,w.jsx)(j.Ay,{sx:{py:.5},children:(0,w.jsx)(b.A,{primary:"\u2022 Skip employees who already have payslips for this period",primaryTypographyProps:{variant:"body2"}})})]})]}),(0,w.jsx)(l.A,{variant:"body2",color:"warning.main",children:"Note: This is a background process. Generated payslips will appear in the payslips list shortly."})]})})};var z=a(64093),E=a(61408),W=a(73216),_=a(46055),M=a(23817);const R={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},B=e=>{let{id:t,name:a}=e;const r=(0,W.Zp)();return(0,w.jsx)(l.A,{sx:R,color:"primary",variant:"h6",onClick:()=>r("/payroll/employees/details/".concat(t)),children:a})},T=e=>[{Header:"Employee Name",accessor:"user.first_name",minWidth:200,Cell:e=>{let{row:t}=e;const{user:a}=t.original,r="".concat(a.first_name," ").concat(a.last_name);return(0,w.jsx)(B,{id:t.original.id,name:r})}},{Header:"Email",accessor:"user.email",minWidth:200},{Header:"Phone",accessor:"user.phone_number",minWidth:150},{Header:"Role",accessor:"user.role",minWidth:120,Cell:e=>{let{row:t}=e;const{user:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12,textTransform:"capitalize"},children:(null===a||void 0===a?void 0:a.role)||"Unknown"})}},{Header:"Salary",accessor:"salary",minWidth:120,Cell:e=>{let{row:t}=e;const{salary:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12,fontWeight:"bold"},children:["UGX ",parseFloat(a).toLocaleString()]})}},{Header:"Contract Start",accessor:"contract_start",minWidth:120,Cell:e=>{let{row:t}=e;const{contract_start:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,_.pU)(a)})}},{Header:"Created At",accessor:"created_at",minWidth:120,Cell:e=>{let{row:t}=e;const{created_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,_.pU)(a)})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const r=a.original;return(0,w.jsx)(M.A,{actions:e,metaData:r},a.id)}}],D={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},L=e=>{let{id:t,period:a}=e;const r=(0,W.Zp)();return(0,w.jsx)(l.A,{sx:D,color:"primary",variant:"h6",onClick:()=>r("/payroll/payslips/details/".concat(t)),children:a})},U=e=>[{Header:"Employee",accessor:"employee.user.first_name",minWidth:200,Cell:e=>{let{row:t}=e;const{employee:a}=t.original,r="".concat(a.user.first_name," ").concat(a.user.last_name);return(0,w.jsx)(S.L9,{sx:{fontSize:12,fontWeight:"medium"},children:r})}},{Header:"Period",accessor:"period",minWidth:120,Cell:e=>{let{row:t}=e;const{period:a}=t.original;return(0,w.jsx)(L,{id:t.original.id,period:(0,_.pU)(a)})}},{Header:"Gross Earnings",accessor:"gross_earnings",minWidth:130,Cell:e=>{let{row:t}=e;const{gross_earnings:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12,color:"success.main",fontWeight:"bold"},children:["UGX ",parseFloat(a).toLocaleString()]})}},{Header:"Deductions",accessor:"deductions",minWidth:120,Cell:e=>{let{row:t}=e;const{deductions:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12,color:"error.main",fontWeight:"bold"},children:["UGX ",parseFloat(a).toLocaleString()]})}},{Header:"Net Pay",accessor:"net_pay",minWidth:120,Cell:e=>{let{row:t}=e;const{net_pay:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12,color:"primary.main",fontWeight:"bold"},children:["UGX ",parseFloat(a).toLocaleString()]})}},{Header:"Employee Role",accessor:"employee.user.role",minWidth:120,Cell:e=>{let{row:t}=e;const{employee:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12,textTransform:"capitalize"},children:a.user.role})}},{Header:"Created At",accessor:"created_at",minWidth:120,Cell:e=>{let{row:t}=e;const{created_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,_.pU)(a)})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const r=a.original;return(0,w.jsx)(M.A,{actions:e,metaData:r},a.id)}}];var I=a(63516),H=a(23722),F=a(80644),G=a(25933);var q=a(15238),V=a(73033);const N=()=>V.Ik().shape({user_id:V.Yj().required("User selection is required"),contract_start:V.p6().required("Contract start date is required").max(new Date,"Contract start date cannot be in the future"),salary:V.ai().required("Salary is required").positive("Salary must be a positive number").min(1,"Salary must be greater than 0").max(999999999.99,"Salary cannot exceed 999,999,999.99")}),O=e=>{let{handleClose:t,formType:a="Save",initialValues:o,callBack:n}=e;const l=(0,d.useRef)(null),[p,u]=(0,d.useState)(!1),[m,h]=(0,d.useState)([]),y=[{name:"user_id",initailValue:"",label:"Select User",type:"select",uiType:"select",uiBreakpoints:{xs:12,sm:12,md:12,lg:12,xl:12},required:!0,options:[]},{name:"contract_start",initailValue:"",label:"Contract Start Date",type:"date",uiType:"date",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"salary",initailValue:"",label:"Monthly Salary (UGX)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0}],x=(0,I.Wx)({initialValues:(0,G.f6)(y),validationSchema:N(),validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>v(e)});(0,d.useEffect)((()=>{A()}),[]),(0,d.useEffect)((()=>{if("Update"===a&&o){var e;const t=(0,G.RA)(y)(o||{});null!==(e=o.user)&&void 0!==e&&e.id&&(t.user_id=o.user.id),x.setValues(t)}}),[o,a,m]);const A=async()=>{try{const e=(await q.D.getUsers({})).results.map((e=>({value:e.id,label:"".concat(e.first_name," ").concat(e.last_name," (").concat(e.email,")")})));h(e)}catch(e){console.error("Error fetching users:",e),c.oR.error("Failed to load users")}},v=async e=>{u(!0);try{"Update"===a?(await g.updateEmployee(e,o.id),c.oR.success("Employee updated successfully")):(await g.createEmployee(e),c.oR.success("Employee created successfully")),x.resetForm(),n&&n(),t(),u(!1)}catch(s){var r;u(!1),null!==(r=s.response)&&void 0!==r&&r.data&&x.setErrors(s.response.data),c.oR.error(s.message||"An error occurred")}},f=()=>{x.resetForm(),t()},j=()=>{x.handleSubmit()},b=y.map((e=>"user_id"===e.name?(0,r.A)((0,r.A)({},e),{},{options:m}):e));return(0,w.jsx)(C.A,{title:"Save"===a?"New Employee":"Edit Employee",onClose:f,id:(0,k.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.A,{onClick:f,disabled:p,children:"Close"}),(0,w.jsx)(i.A,{onClick:j,type:"button",variant:"contained",disabled:p,children:p?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(H.A,{color:"inherit",size:20})," ",(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Employee":"Create Employee"})]}),children:(0,w.jsx)("form",{ref:l,onSubmit:e=>{e.preventDefault(),v(x.values)},encType:"multipart/form-data",children:(0,w.jsx)(s.A,{sx:{width:"100%"},children:(0,w.jsx)(F.A,{others:{sx:{marginBottom:"0rem"}},formikInstance:x,formFields:b,validationSchema:N()})})})})},Y=()=>V.Ik().shape({employee_id:V.Yj().required("Employee selection is required"),period:V.p6().required("Payroll period is required").max(new Date,"Payroll period cannot be in the future"),gross_earnings:V.ai().required("Gross earnings is required").positive("Gross earnings must be a positive number").min(0,"Gross earnings cannot be negative").max(999999999.99,"Gross earnings cannot exceed 999,999,999.99"),deductions:V.ai().required("Deductions is required").min(0,"Deductions cannot be negative").max(999999999.99,"Deductions cannot exceed 999,999,999.99").test("deductions-not-greater-than-earnings","Deductions cannot be greater than gross earnings",(function(e){const{gross_earnings:t}=this.parent;return!t||!e||parseFloat(e.toString())<=parseFloat(t.toString())}))}),X=e=>{let{handleClose:t,formType:a="Save",initialValues:o,callBack:n}=e;const l=(0,d.useRef)(null),[p,u]=(0,d.useState)(!1),[m,h]=(0,d.useState)([]),y=[{name:"employee_id",initailValue:"",label:"Select Employee",type:"select",uiType:"select",uiBreakpoints:{xs:12,sm:12,md:12,lg:12,xl:12},required:!0,options:[]},{name:"period",initailValue:"",label:"Payroll Period",type:"date",uiType:"date",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"gross_earnings",initailValue:"",label:"Gross Earnings (UGX)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"deductions",initailValue:"",label:"Total Deductions (UGX)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0}],x=(0,I.Wx)({initialValues:(0,G.f6)(y),validationSchema:Y(),validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>v(e)});(0,d.useEffect)((()=>{A()}),[]),(0,d.useEffect)((()=>{if("Update"===a&&o){var e;const t=(0,G.RA)(y)(o||{});null!==(e=o.employee)&&void 0!==e&&e.id&&(t.employee_id=o.employee.id),x.setValues(t)}}),[o,a,m]);const A=async()=>{try{const e=(await g.getEmployees({})).results.map((e=>({value:e.id,label:"".concat(e.user.first_name," ").concat(e.user.last_name," - ").concat(e.user.role)})));h(e)}catch(e){console.error("Error fetching employees:",e),c.oR.error("Failed to load employees")}},v=async e=>{u(!0);try{"Update"===a?(await g.updatePayslip(e,o.id),c.oR.success("Payslip updated successfully")):(await g.createPayslip(e),c.oR.success("Payslip created successfully")),x.resetForm(),n&&n(),t(),u(!1)}catch(s){var r;u(!1),null!==(r=s.response)&&void 0!==r&&r.data&&x.setErrors(s.response.data),c.oR.error(s.message||"An error occurred")}},f=()=>{x.resetForm(),t()},j=()=>{x.handleSubmit()},b=y.map((e=>"employee_id"===e.name?(0,r.A)((0,r.A)({},e),{},{options:m}):e));return(0,w.jsx)(C.A,{title:"Save"===a?"New Payslip":"Edit Payslip",onClose:f,id:(0,k.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(i.A,{onClick:f,disabled:p,children:"Close"}),(0,w.jsx)(i.A,{onClick:j,type:"button",variant:"contained",disabled:p,children:p?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(H.A,{color:"inherit",size:20})," ",(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Payslip":"Create Payslip"})]}),children:(0,w.jsx)("form",{ref:l,onSubmit:e=>{e.preventDefault(),v(x.values)},encType:"multipart/form-data",children:(0,w.jsx)(s.A,{sx:{width:"100%"},children:(0,w.jsx)(F.A,{others:{sx:{marginBottom:"0rem"}},formikInstance:x,formFields:b,validationSchema:Y()})})})})};var Z=a(36644);const J={tablePreHeader:{display:"flex",alignItems:"center",gap:2,marginBottom:2},statsContainer:{display:"flex",gap:2,marginBottom:3},statCard:{padding:2,borderRadius:2,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",minWidth:120,textAlign:"center"}},K=()=>{(0,h.A)("Payroll Management");const{setShowModal:e}=(0,y.k3)(),[t,a]=(0,d.useState)("employees"),[x,A]=(0,d.useState)(null),[v,f]=(0,d.useState)(null),[j,b]=(0,d.useState)("Save"),[C,S]=(0,d.useState)(""),[k,W]=(0,d.useState)(),[_,M]=(0,d.useState)(),[R,B]=(0,d.useState)(null),[D,L]=(0,d.useState)(!1),[I,H]=(0,d.useState)(!1);(0,d.useEffect)((()=>{"employees"===t?F(R):G(R)}),[R,t]);const F=async e=>{try{L(!0);const t=await g.getEmployees(e);W(t),L(!1)}catch(t){L(!1),console.error("Error fetching Employees:",t)}},G=async e=>{try{L(!0);const t=await g.getPayslips(e);M(t),L(!1)}catch(t){L(!1),console.error("Error fetching Payslips:",t)}},q=async()=>{try{if(L(!0),"employees"===t){const e=await g.getEmployees({search:C});W(e)}else{const e=await g.getPayslips({search:C});M(e)}L(!1)}catch(e){L(!1)}},V=()=>{b("Save"),A(null),f(null),e(!0)},N=()=>{e(!1),A(null),f(null)},Y=()=>{H(!0)},K=[{label:"Edit",icon:(0,w.jsx)(u.A,{color:"primary"}),onClick:t=>(t=>{b("Update"),A(t),setTimeout((()=>{e(!0)}))})(t)},{label:"Delete Employee",icon:(0,w.jsx)(p.A,{color:"error"}),onClick:e=>(async e=>{try{await g.deleteEmployee(null===e||void 0===e?void 0:e.id),c.oR.success("Employee deleted successfully"),q()}catch(t){c.oR.error("Something went wrong")}})(e)}],Q=[{label:"Edit",icon:(0,w.jsx)(u.A,{color:"primary"}),onClick:t=>(t=>{b("Update"),f(t),setTimeout((()=>{e(!0)}))})(t)},{label:"Delete Payslip",icon:(0,w.jsx)(p.A,{color:"error"}),onClick:e=>(async e=>{try{await g.deletePayslip(null===e||void 0===e?void 0:e.id),c.oR.success("Payslip deleted successfully"),q()}catch(t){c.oR.error("Something went wrong")}})(e)}];return(0,w.jsxs)(s.A,{pt:2,pb:4,children:[(0,w.jsx)(s.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,w.jsxs)(o.A,{value:t,onChange:(e,t)=>{a(t),B(null),S("")},sx:{mb:2},children:[(0,w.jsx)(n.A,{label:"Employees",value:"employees"}),(0,w.jsx)(n.A,{label:"Payslips",value:"payslips"})]})}),(0,w.jsxs)(s.A,{sx:J.tablePreHeader,children:[(0,w.jsx)(z.A,{value:C,onChange:e=>{const t=e.target.value;S(t)},type:"text",placeholder:"Search ".concat(t,"...")}),(0,w.jsxs)(s.A,{sx:{display:"flex",gap:1,marginLeft:"auto"},children:["payslips"===t&&(0,w.jsx)(i.A,{variant:"outlined",color:"secondary",startIcon:(0,w.jsx)(m.A,{}),onClick:Y,children:"Generate Monthly"}),(0,w.jsx)(i.A,{variant:"contained",onClick:V,children:"employees"===t?"Add Employee":"Create Payslip"})]})]}),(0,w.jsx)(s.A,{sx:J.statsContainer,children:(0,w.jsxs)(s.A,{sx:J.statCard,children:[(0,w.jsx)(l.A,{variant:"h6",color:"primary",children:"employees"===t?(null===k||void 0===k?void 0:k.count)||0:(null===_||void 0===_?void 0:_.count)||0}),(0,w.jsxs)(l.A,{variant:"body2",color:"textSecondary",children:["Total ","employees"===t?"Employees":"Payslips"]})]})}),"employees"===t?(0,w.jsx)(E.A,{columnShape:T(K),data:(null===k||void 0===k?void 0:k.results)||[],dataCount:(null===k||void 0===k?void 0:k.count)||0,pageInitialState:{pageSize:Z.hk,pageIndex:0},setPageIndex:e=>B((0,r.A)((0,r.A)({},R),{},{page:e})),pageIndex:(null===R||void 0===R?void 0:R.page)||1,setPageSize:e=>B((0,r.A)((0,r.A)({},R),{},{page_size:e})),loading:D}):(0,w.jsx)(E.A,{columnShape:U(Q),data:(null===_||void 0===_?void 0:_.results)||[],dataCount:(null===_||void 0===_?void 0:_.count)||0,pageInitialState:{pageSize:Z.hk,pageIndex:0},setPageIndex:e=>B((0,r.A)((0,r.A)({},R),{},{page:e})),pageIndex:(null===R||void 0===R?void 0:R.page)||1,setPageSize:e=>B((0,r.A)((0,r.A)({},R),{},{page_size:e})),loading:D}),"employees"===t?(0,w.jsx)(O,{callBack:q,formType:j,handleClose:N,initialValues:x}):(0,w.jsx)(X,{callBack:q,formType:j,handleClose:N,initialValues:v}),I&&(0,w.jsx)(P,{handleClose:()=>{H(!1)},callBack:()=>{a("payslips"),q()}})]})}},63471:(e,t,a)=>{var r=a(24994);t.A=void 0;var s=r(a(40039)),i=a(70579);t.A=(0,s.default)((0,i.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},64093:(e,t,a)=>{a.d(t,{A:()=>d});var r=a(89379),s=a(34535),i=a(62559),o=a(49250),n=a(70579);const l=(0,s.Ay)(i.Ay)((e=>{let{theme:t}=e;return{height:35,fontSize:13,width:"100%",maxWidth:270,fontWeight:500,padding:"0 1rem",borderRadius:"8px",border:"1px solid ",borderColor:"light"===t.palette.mode?t.palette.secondary[300]:t.palette.divider,color:t.palette.text.primary,backgroundColor:t.palette.background.paper,[t.breakpoints.down(500)]:{maxWidth:"100%"}}})),d=e=>(0,n.jsx)(l,(0,r.A)((0,r.A)({},e),{},{sx:(0,r.A)({justifyContent:"initial"},e.sx),startAdornment:(0,n.jsx)(o.A,{sx:{fontSize:13,marginRight:1,color:"#bbb"}})}))},74523:(e,t,a)=>{a.d(t,{A:()=>v});a(65043);var r=a(8302),s=a(34535),i=a(90035),o=a(4219),n=a(35316),l=a(29347),d=a(17392),c=a(74802),p=a(8433),u=a(42438),m=a(96446),h=a(10611),y=a(70579);const x=(0,s.Ay)(i.A)((e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}})),g=e=>{const{title:t,onClose:a,id:r}=e;return(0,y.jsxs)(o.A,{sx:{m:0,p:2},id:r,children:[(0,y.jsx)(u.L9,{sx:{fontSize:"1.2rem",fontWeight:"bold",padding:10,paddingLeft:0},children:t}),a?(0,y.jsx)(d.A,{"aria-label":"close",onClick:a,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,y.jsx)(c.A,{})}):null]})},A={loadingModalContentBackground:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#fff",opacity:.6,zIndex:1e3,pointerEvents:"none"}},v=e=>{let{children:t,onClose:a,title:s,maxWidth:i,minWidth:o,ActionButtons:d,selectedModalId:c,open:u}=e;const{showModal:v,loadingModalContent:f,modalId:j}=(0,p.k3)();if(!v&&!u)return null;if(void 0!==j&&j!==c)return null;return(0,y.jsx)(m.A,{children:(0,y.jsxs)(x,{onClose:e=>{a()},"aria-labelledby":"customized-dialog-title",open:void 0!==u?u:v,maxWidth:i,sx:{"& .MuiPaper-root":{minWidth:o||0}},style:{borderRadius:"10px"},children:[f&&(0,y.jsx)(m.A,{sx:{width:"100%",zIndex:1200},children:(0,y.jsx)(h.A,{})}),(0,y.jsx)(m.A,{sx:f?A.loadingModalContentBackground:{}}),(0,y.jsx)(g,{id:"customized-dialog-title",title:s,onClose:a}),(0,y.jsx)(n.A,{dividers:!0,children:t}),(0,y.jsx)(l.A,{children:d?(0,y.jsx)(d,{}):(0,y.jsx)(r.A,{autoFocus:!0,onClick:a,children:"Cancel"})})]})})}},74802:(e,t,a)=>{var r=a(24994);t.A=void 0;var s=r(a(40039)),i=a(70579);t.A=(0,s.default)((0,i.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},95540:(e,t,a)=>{var r=a(24994);t.A=void 0;var s=r(a(40039)),i=a(70579);t.A=(0,s.default)((0,i.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")}}]);
//# sourceMappingURL=1569.9ad6307a.chunk.js.map