"use strict";(self.webpackChunkgrain_voucher_system=self.webpackChunkgrain_voucher_system||[]).push([[582],{582:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var n=a(65043),s=a(96446),i=a(14912),r=a(24056),l=a(13194),o=a(29420),c=a(24959),d=a(86164),u=a(42575),m=a(70579);const h=()=>{(0,l.A)("Accounting");const[e,t]=(0,n.useState)(0);return(0,m.jsxs)(s.A,{pt:2,pb:4,children:[(0,m.jsxs)(i.A,{value:e,onChange:(e,a)=>{t(a)},"aria-label":"Accounting Tabs",centered:!0,children:[(0,m.jsx)(r.A,{label:"Invoices"}),(0,m.jsx)(r.A,{label:"Payments"}),(0,m.jsx)(r.A,{label:"Journal Entries"}),(0,m.jsx)(r.A,{label:"Budgets"})]}),0===e&&(0,m.jsx)(o.default,{}),1===e&&(0,m.jsx)(c.default,{}),2===e&&(0,m.jsx)(d.default,{}),3===e&&(0,m.jsx)(u.default,{})]})}},24959:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a(89379),s=a(96446),i=a(8302),r=a(65043),l=a(23768),o=a(63471),c=a(95540),d=a(19778),u=a(13194),m=a(8433),h=a(15909),p=a(64093),y=a(61408),g=a(85865),x=a(73216),b=a(46055),v=a(23817),A=a(42438),j=a(70579);const f={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},S=e=>{let{id:t,number:a}=e;const n=(0,x.Zp)();return(0,j.jsx)(g.A,{sx:f,color:"primary",variant:"h6",onClick:()=>n("/admin/accounting/payments/details/".concat(t)),children:a})},_=e=>[{Header:"Payment Number",accessor:"payment_number",minWidth:150,Cell:e=>{let{row:t}=e;return(0,j.jsx)(S,{id:t.original.id,number:t.original.payment_number})}},{Header:"Invoice",accessor:"invoice_details.invoice_number",minWidth:150},{Header:"Amount",accessor:"amount",minWidth:120},{Header:"Payment Date",accessor:"payment_date",minWidth:120,Cell:e=>{let{value:t}=e;return(0,b.pU)(t)}},{Header:"Method",accessor:"payment_method_display",minWidth:120},{Header:"Status",accessor:"status_display",minWidth:120},{Header:"Reconciled",accessor:"reconciled",minWidth:100,Cell:e=>{let{value:t}=e;return(0,j.jsx)(A.L9,{children:t?"Yes":"No"})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;return(0,j.jsx)(v.A,{actions:e,metaData:a.original},a.id)}}];var B=a(12110),C=a(26494),k=a(39336),P=a(68903),T=a(43845),H=a(67254),W=a(63516),w=a(74523),q=a(23722),I=a(80644),V=a(25933),R=a(75992);const D=[{value:"cash",label:"Cash"},{value:"bank_transfer",label:"Bank Transfer"},{value:"mobile_money",label:"Mobile Money"},{value:"cheque",label:"Cheque"},{value:"credit_card",label:"Credit Card"},{value:"other",label:"Other"}],U=[{value:"pending",label:"Pending"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}];var E=a(73033);const L=()=>E.Ik().shape({invoice:E.Yj().required("Invoice is required"),amount:E.ai().min(.01,"Amount must be greater than 0").required(),payment_date:E.p6().required("Payment date is required"),payment_method:E.Yj().required("Payment method is required"),status:E.Yj().required("Status is required")});var N=a(90531);const F=e=>{let{handleClose:t,formType:a="Save",initialValues:n,callBack:o}=e;const c=(0,r.useRef)(null),[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)([]),[y,x]=(0,r.useState)(null);(0,r.useEffect)((()=>{N.p.getInvoices({}).then((e=>{p(e.results)}))}),[]);const v=(e=>{const{invoices:t,accounts:a}=e;return[{name:"invoice",initailValue:"",label:"Invoice",type:"select",uiType:"select",options:t,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"amount",initailValue:0,label:"Amount",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"payment_date",initailValue:"",label:"Payment Date",uiType:"date",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"payment_method",initailValue:"",label:"Payment Method",type:"select",uiType:"select",options:D,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"reference_number",initailValue:"",label:"Reference Number",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}},{name:"status",initailValue:"pending",label:"Status",type:"select",uiType:"select",options:U,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}},{name:"notes",initailValue:"",label:"Notes",type:"textarea",uiType:"textarea",uiBreakpoints:{xs:12}}]})({invoices:m.map((e=>({value:e.id,label:"".concat(e.invoice_number," - ").concat(e.account_name," (UGX ").concat(e.amount_due.toLocaleString(),")")}))),accounts:[]}),f=(0,W.Wx)({initialValues:(0,V.f6)(v),validationSchema:L(),validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>S(e)});(0,r.useEffect)((()=>{if("Update"===a&&n&&(f.setValues((0,V.RA)(v)(n||{})),n.invoice_id)){const e=m.find((e=>e.id===n.invoice_id));x(e)}}),[n,a,m]),(0,r.useEffect)((()=>{const e=f.values.invoice;if(e){const t=m.find((t=>t.id===e));x(t),t&&"Save"===a&&f.setFieldValue("amount",t.amount_due)}else x(null)}),[f.values.invoice,m]);const S=async e=>{u(!0);try{"Update"===a?(await h.W.updatePayment(e,n.id),l.oR.success("Payment updated successfully")):(await h.W.createPayment(e),l.oR.success("Payment created successfully")),f.resetForm(),x(null),o&&o(),t()}catch(i){var s;null!==(s=i.response)&&void 0!==s&&s.data&&f.setErrors(i.response.data),l.oR.error(i.message||"An error occurred")}finally{u(!1)}},_=()=>{f.resetForm(),x(null),t()},E=()=>{f.handleSubmit()};return(0,j.jsx)(w.A,{title:"Save"===a?"New Payment":"Edit Payment",onClose:_,id:(0,R.A)(),ActionButtons:()=>(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(i.A,{onClick:_,disabled:d,children:"Close"}),(0,j.jsx)(i.A,{onClick:E,type:"button",variant:"contained",disabled:d,children:d?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(q.A,{color:"inherit",size:20})," ",(0,j.jsx)(A.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Payment":"Create Payment"})]}),maxWidth:"md",children:(0,j.jsx)("form",{ref:c,onSubmit:e=>{e.preventDefault(),S(f.values)},encType:"multipart/form-data",children:(0,j.jsxs)(s.A,{sx:{width:"100%"},children:[(0,j.jsx)(I.A,{others:{sx:{marginBottom:"1rem"}},formikInstance:f,formFields:v.slice(0,1),validationSchema:L()}),y&&(0,j.jsx)(B.A,{variant:"outlined",sx:{mb:3,backgroundColor:"#f8f9fa"},children:(0,j.jsxs)(C.A,{children:[(0,j.jsx)(g.A,{variant:"h6",gutterBottom:!0,color:"primary",children:"Invoice Details"}),(0,j.jsx)(k.A,{sx:{mb:2}}),(0,j.jsxs)(P.Ay,{container:!0,spacing:2,children:[(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Account Name"}),(0,j.jsx)(g.A,{variant:"body1",fontWeight:"bold",children:y.account_name})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Invoice Number"}),(0,j.jsx)(g.A,{variant:"body1",fontWeight:"bold",children:y.invoice_number})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Issue Date"}),(0,j.jsx)(g.A,{variant:"body1",children:(0,b.pU)(y.issue_date)})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Due Date"}),(0,j.jsx)(g.A,{variant:"body1",children:(0,b.pU)(y.due_date)})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Total Amount"}),(0,j.jsxs)(g.A,{variant:"body1",fontWeight:"bold",children:["UGX ",y.total_amount.toLocaleString()]})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Amount Paid"}),(0,j.jsxs)(g.A,{variant:"body1",children:["UGX ",y.amount_paid.toLocaleString()]})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Amount Due"}),(0,j.jsxs)(g.A,{variant:"body1",fontWeight:"bold",color:"error.main",children:["UGX ",y.amount_due.toLocaleString()]})]}),(0,j.jsxs)(P.Ay,{item:!0,xs:6,children:[(0,j.jsx)(g.A,{variant:"body2",color:"text.secondary",children:"Status"}),(0,j.jsxs)(s.A,{sx:{mt:.5},children:[(0,j.jsx)(T.A,{label:y.status_display,size:"small",color:"issued"===y.status?"success":"default"}),(0,j.jsx)(T.A,{label:y.payment_status_display,size:"small",color:"paid"===y.payment_status?"success":"warning",sx:{ml:1}})]})]}),y.days_overdue>0&&(0,j.jsx)(P.Ay,{item:!0,xs:12,children:(0,j.jsxs)(H.A,{severity:"warning",sx:{mt:1},children:["This invoice is ",(0,j.jsxs)("strong",{children:[y.days_overdue," days overdue"]})]})})]})]})}),(0,j.jsx)(I.A,{others:{sx:{marginBottom:"0rem"}},formikInstance:f,formFields:v.slice(1),validationSchema:L()})]})})})};var z=a(36644);const G={tablePreHeader:{display:"flex",alignItems:"center",gap:2,marginBottom:2}},M=()=>{(0,u.A)("Payments");const{setShowModal:e}=(0,m.k3)(),[t,a]=(0,r.useState)(null),[g,x]=(0,r.useState)("Save"),[b,v]=(0,r.useState)(""),[A,f]=(0,r.useState)(),[S,B]=(0,r.useState)(null),[C,k]=(0,r.useState)(!1);(0,r.useEffect)((()=>{P(S)}),[S]);const P=async e=>{try{k(!0);const t=await h.W.getPayments(e);f(t),k(!1)}catch(t){k(!1),console.error("Error fetching Payments:",t)}},T=()=>{P(S)},H=[{label:"Edit",icon:(0,j.jsx)(c.A,{color:"primary"}),onClick:t=>{x("Update"),a(t),setTimeout((()=>e(!0)),0)}},{label:"Reconcile",icon:(0,j.jsx)(d.A,{color:"primary"}),onClick:async e=>{try{await h.W.reconcilePayment(e.id),l.oR.success("Payment reconciled successfully"),T()}catch(t){l.oR.error("Something went wrong")}}},{label:"Delete",icon:(0,j.jsx)(o.A,{color:"error"}),onClick:async e=>{try{await h.W.deletePayment(e.id),l.oR.success("Payment deleted successfully"),T()}catch(t){l.oR.error("Something went wrong")}}}];return(0,j.jsxs)(s.A,{pt:2,pb:4,children:[(0,j.jsxs)(s.A,{sx:G.tablePreHeader,children:[(0,j.jsx)(p.A,{value:b,onChange:e=>{const t=e.target.value;v(t),B((0,n.A)((0,n.A)({},S),{},{search:t}))},type:"text",placeholder:"Search payment..."}),(0,j.jsx)(i.A,{sx:{marginLeft:"auto"},variant:"contained",onClick:()=>{x("Save"),a(null),e(!0)},children:"Create Payment"})]}),(0,j.jsx)(y.A,{columnShape:_(H),data:(null===A||void 0===A?void 0:A.results)||[],dataCount:(null===A||void 0===A?void 0:A.count)||0,pageInitialState:{pageSize:z.hk,pageIndex:0},setPageIndex:e=>B((0,n.A)((0,n.A)({},S),{},{page:e})),pageIndex:(null===S||void 0===S?void 0:S.page)||1,setPageSize:e=>B((0,n.A)((0,n.A)({},S),{},{page_size:e})),loading:C}),(0,j.jsx)(F,{callBack:T,formType:g,handleClose:()=>{e(!1)},initialValues:t||{}})]})}},42575:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var n=a(89379),s=a(96446),i=a(8302),r=a(65043),l=a(23768),o=a(63471),c=a(95540),d=a(13194),u=a(8433),m=a(96581),h=a(64093),p=a(61408),y=a(85865),g=a(73216),x=a(46055),b=a(23817),v=a(42438),A=a(70579);const j={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},f=e=>{let{id:t,period:a}=e;const n=(0,g.Zp)();return(0,A.jsx)(y.A,{sx:j,color:"primary",variant:"h6",onClick:()=>n("/admin/accounting/budgets/details/".concat(t)),children:(0,x.pU)(a)})},S=e=>[{Header:"Period",accessor:"period",minWidth:120,Cell:e=>{let{row:t}=e;return(0,A.jsx)(f,{id:t.original.id,period:t.original.period})}},{Header:"Hub",accessor:"hub.name",minWidth:150},{Header:"Grain Type",accessor:"grain_type.name",minWidth:150},{Header:"Budgeted Amount",accessor:"budgeted_amount",minWidth:120},{Header:"Actual Amount",accessor:"actual_amount",minWidth:120},{Header:"Variance",accessor:"variance",minWidth:120},{Header:"Variance %",accessor:"variance_percentage",minWidth:100},{Header:"Over Budget",accessor:"is_over_budget",minWidth:120,Cell:e=>{let{value:t}=e;return(0,A.jsx)(v.L9,{children:t?"Yes":"No"})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;return(0,A.jsx)(b.A,{actions:e,metaData:a.original},a.id)}}];var _=a(63516),B=a(74523),C=a(23722),k=a(80644),P=a(25933),T=a(75992);var H=a(73033);const W=()=>H.Ik().shape({period:H.p6().required("Period is required"),budgeted_amount:H.ai().min(0,"Budgeted amount must be >= 0").required()});var w=a(76415),q=a(60975);const I=e=>{let{handleClose:t,formType:a="Save",initialValues:n,callBack:o}=e;const c=(0,r.useRef)(null),[d,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)([]),[y,g]=(0,r.useState)([]);(0,r.useEffect)((()=>{w.b.getHubs({}).then((e=>p(e.results.map((e=>({value:e.id,label:e.name})))))),q.X.getGrainTypes({}).then((e=>g(e.results.map((e=>({value:e.id,label:e.name}))))))}),[]);const x=(e=>{const{hubs:t,grainTypes:a}=e;return[{name:"period",initailValue:"",label:"Period",uiType:"date",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"hub_id",initailValue:"",label:"Hub",type:"select",uiType:"select",options:t,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!1},{name:"grain_type_id",initailValue:"",label:"Grain Type",type:"select",uiType:"select",options:a,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!1},{name:"budgeted_amount",initailValue:0,label:"Budgeted Amount",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0}]})({hubs:h,grainTypes:y}),b=(0,_.Wx)({initialValues:(0,P.f6)(x),validationSchema:W(),validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>j(e)});(0,r.useEffect)((()=>{"Update"===a&&n&&b.setValues((0,P.RA)(x)(n||{}))}),[n,a]);const j=async e=>{u(!0);try{"Update"===a?(await m.N.updateBudget(e,n.id),l.oR.success("Budget updated successfully")):(await m.N.createBudget(e),l.oR.success("Budget created successfully")),b.resetForm(),o&&o(),t()}catch(i){var s;null!==(s=i.response)&&void 0!==s&&s.data&&b.setErrors(i.response.data),l.oR.error(i.message||"An error occurred")}finally{u(!1)}},f=()=>{b.resetForm(),t()},S=()=>{b.handleSubmit()};return(0,A.jsx)(B.A,{title:"Save"===a?"New Budget":"Edit Budget",onClose:f,id:(0,T.A)(),ActionButtons:()=>(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(i.A,{onClick:f,disabled:d,children:"Close"}),(0,A.jsx)(i.A,{onClick:S,type:"button",variant:"contained",disabled:d,children:d?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(C.A,{color:"inherit",size:20})," ",(0,A.jsx)(v.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Budget":"Create Budget"})]}),children:(0,A.jsx)("form",{ref:c,onSubmit:e=>{e.preventDefault(),j(b.values)},encType:"multipart/form-data",children:(0,A.jsx)(s.A,{sx:{width:"100%"},children:(0,A.jsx)(k.A,{others:{sx:{marginBottom:"0rem"}},formikInstance:b,formFields:x,validationSchema:W()})})})})};var V=a(36644);const R={tablePreHeader:{display:"flex",alignItems:"center",gap:2,marginBottom:2}},D=()=>{(0,d.A)("Budgets");const{setShowModal:e}=(0,u.k3)(),[t,a]=(0,r.useState)(null),[y,g]=(0,r.useState)("Save"),[x,b]=(0,r.useState)(""),[v,j]=(0,r.useState)(),[f,_]=(0,r.useState)(null),[B,C]=(0,r.useState)(!1);(0,r.useEffect)((()=>{k(f)}),[f]);const k=async e=>{try{C(!0);const t=await m.N.getBudgets(e);j(t),C(!1)}catch(t){C(!1),console.error("Error fetching Budgets:",t)}},P=()=>{k(f)},T=[{label:"Edit",icon:(0,A.jsx)(c.A,{color:"primary"}),onClick:t=>{g("Update"),a(t),setTimeout((()=>e(!0)),0)}},{label:"Delete",icon:(0,A.jsx)(o.A,{color:"error"}),onClick:async e=>{try{await m.N.deleteBudget(e.id),l.oR.success("Budget deleted successfully"),P()}catch(t){l.oR.error("Something went wrong")}}}];return(0,A.jsxs)(s.A,{pt:2,pb:4,children:[(0,A.jsxs)(s.A,{sx:R.tablePreHeader,children:[(0,A.jsx)(h.A,{value:x,onChange:e=>{const t=e.target.value;b(t),_((0,n.A)((0,n.A)({},f),{},{search:t}))},type:"text",placeholder:"Search budget..."}),(0,A.jsx)(i.A,{sx:{marginLeft:"auto"},variant:"contained",onClick:()=>{g("Save"),a(null),e(!0)},children:"Create Budget"})]}),(0,A.jsx)(p.A,{columnShape:S(T),data:(null===v||void 0===v?void 0:v.results)||[],dataCount:(null===v||void 0===v?void 0:v.count)||0,pageInitialState:{pageSize:V.hk,pageIndex:0},setPageIndex:e=>_((0,n.A)((0,n.A)({},f),{},{page:e})),pageIndex:(null===f||void 0===f?void 0:f.page)||1,setPageSize:e=>_((0,n.A)((0,n.A)({},f),{},{page_size:e})),loading:B}),(0,A.jsx)(I,{callBack:P,formType:y,handleClose:()=>{e(!1)},initialValues:t||{}})]})}},60975:(e,t,a)=>{a.d(t,{X:()=>s});var n=a(56629);const s={getGrainTypes:async e=>n.A.get("vouchers/grain-types/",{params:e}).then((e=>e.data)),getGrainTypeDetails:async e=>n.A.get("vouchers/grain-types/".concat(e,"/")).then((e=>e.data)),createGrainTypes:async e=>(console.log(e),n.A.post("vouchers/grain-types/",e).then((e=>e.data))),updateGrainTypes:async(e,t)=>(console.log(e),n.A.patch("vouchers/grain-types/".concat(t,"/"),e).then((e=>e.data))),deleteGrainTypes:async e=>(console.log(e),n.A.delete("vouchers/grain-types/".concat(e,"/")).then((e=>e.data)))}},76415:(e,t,a)=>{a.d(t,{b:()=>s});var n=a(56629);const s={getHubs:async e=>n.A.get("hubs/",{params:e}).then((e=>e.data)),getHubDetails:async e=>n.A.get("hubs/".concat(e,"/")).then((e=>e.data)),assignHubAdmin:async(e,t)=>n.A.post("hubs/".concat(e,"/assign-admin/"),t).then((e=>e.data)),unassignHubAdmin:async(e,t)=>n.A.post("hubs/".concat(e,"/unassign-admin/"),t).then((e=>e.data)),async createHubs(e){const t=new FormData;for(const a in e)t.append(a,e[a]);return n.A.post("hubs/",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>e.data))},updateHubs:async(e,t)=>(console.log(e),n.A.patch("hubs/".concat(t,"/"),e).then((e=>e.data))),deleteHubs:async e=>(console.log(e),n.A.delete("hubs/".concat(e,"/")).then((e=>e.data))),searchHubs:async e=>n.A.get("supported-Hubs/",{params:{query:e}}).then((e=>e.data))}},96581:(e,t,a)=>{a.d(t,{N:()=>s});var n=a(56629);const s={getBudgets:async e=>n.A.get("accounting/budgets/",{params:e}).then((e=>e.data)),getBudgetDetails:async e=>n.A.get("accounting/budgets/".concat(e,"/")).then((e=>e.data)),createBudget:async e=>n.A.post("accounting/budgets/",e).then((e=>e.data)),updateBudget:async(e,t)=>n.A.patch("accounting/budgets/".concat(t,"/"),e).then((e=>e.data)),deleteBudget:async e=>n.A.delete("accounting/budgets/".concat(e,"/")).then((e=>e.data)),getPerformance:async e=>n.A.get("accounting/budgets/performance/",{params:e}).then((e=>e.data))}}}]);
//# sourceMappingURL=582.8ed88814.chunk.js.map