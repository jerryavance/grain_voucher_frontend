"use strict";(self.webpackChunkgrain_voucher_system=self.webpackChunkgrain_voucher_system||[]).push([[5712],{45712:(e,t,a)=>{a.r(t),a.d(t,{default:()=>te});var i=a(89379),r=a(96446),s=a(14912),n=a(24056),l=a(93933),o=a(8302),c=a(65043),u=a(23768),d=a(63471),m=a(95540),p=a(19778),h=a(54469),x=a(13194),v=a(8433),g=a(56355),y=a(64093),f=a(61408),b=a(85865),C=a(43845),A=a(46055),j=a(23817),S=a(42438),w=a(70579);const _={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},k=e=>[{Header:"Name",accessor:"name",minWidth:200,Cell:e=>{let{row:t}=e;const{name:a}=t.original;return(0,w.jsx)(b.A,{sx:_,color:"primary",variant:"h6",children:a})}},{Header:"Type",accessor:"type",minWidth:120,Cell:e=>{let{row:t}=e;const{type:a}=t.original;return(0,w.jsx)(C.A,{label:a.charAt(0).toUpperCase()+a.slice(1),color:(()=>{switch(a){case"customer":return"success";case"supplier":return"warning";case"investor":return"info";default:return"default"}})(),size:"small"})}},{Header:"Credit Terms",accessor:"credit_terms_days",minWidth:120,Cell:e=>{let{row:t}=e;const{credit_terms_days:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12},children:[a," days"]})}},{Header:"Hub",accessor:"hub",minWidth:150,Cell:e=>{let{row:t}=e;const{hub:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(null===a||void 0===a?void 0:a.name)||"No Hub"})}},{Header:"Created",accessor:"created_at",minWidth:100,Cell:e=>{let{row:t}=e;const{created_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,A.pU)(a)})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const i=a.original;return(0,w.jsx)(j.A,{actions:e,metaData:i},a.id)}}],q=e=>[{Header:"Name",accessor:"name",minWidth:150,Cell:e=>{let{row:t}=e;const{name:a}=t.original;return(0,w.jsx)(b.A,{sx:_,color:"primary",variant:"h6",children:a})}},{Header:"Phone",accessor:"phone",minWidth:130},{Header:"Email",accessor:"email",minWidth:180,Cell:e=>{let{row:t}=e;const{email:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a||"N/A"})}},{Header:"Role",accessor:"role",minWidth:100,Cell:e=>{let{row:t}=e;const{role:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a||"N/A"})}},{Header:"Account",accessor:"account",minWidth:180,Cell:e=>{let{row:t}=e;const{account:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:null===a||void 0===a?void 0:a.name})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const i=a.original;return(0,w.jsx)(j.A,{actions:e,metaData:i},a.id)}}],E=e=>[{Header:"Name",accessor:"name",minWidth:150,Cell:e=>{let{row:t}=e;const{name:a}=t.original;return(0,w.jsx)(b.A,{sx:_,color:"primary",variant:"h6",children:a})}},{Header:"Account",accessor:"account",minWidth:150,Cell:e=>{let{row:t}=e;const{account:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:null===a||void 0===a?void 0:a.name})}},{Header:"Volume (MT)",accessor:"expected_volume_mt",minWidth:120,Cell:e=>{let{row:t}=e;const{expected_volume_mt:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a.toLocaleString()})}},{Header:"Price/MT",accessor:"expected_price_per_mt",minWidth:120,Cell:e=>{let{row:t}=e;const{expected_price_per_mt:a}=t.original;return(0,w.jsxs)(S.L9,{sx:{fontSize:12},children:["$",a.toLocaleString()]})}},{Header:"Stage",accessor:"stage",minWidth:100,Cell:e=>{let{row:t}=e;const{stage:a}=t.original;return(0,w.jsx)(C.A,{label:a.charAt(0).toUpperCase()+a.slice(1),color:(()=>{switch(a){case"prospect":return"primary";case"quote":return"warning";case"won":return"success";case"lost":return"error";default:return"default"}})(),size:"small"})}},{Header:"Assigned To",accessor:"assigned_to",minWidth:150,Cell:e=>{let{row:t}=e;const{assigned_to:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a?"".concat(a.first_name," ").concat(a.last_name):"Unassigned"})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const i=a.original;return(0,w.jsx)(j.A,{actions:e,metaData:i},a.id)}}],B=e=>[{Header:"Opportunity",accessor:"opportunity",minWidth:200,Cell:e=>{let{row:t}=e;const{opportunity:a}=t.original;return(0,w.jsx)(b.A,{sx:_,color:"primary",variant:"h6",children:null===a||void 0===a?void 0:a.name})}},{Header:"Account",accessor:"opportunity.account",minWidth:150,Cell:e=>{var t;let{row:a}=e;const{opportunity:i}=a.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:null===i||void 0===i||null===(t=i.account)||void 0===t?void 0:t.name})}},{Header:"Status",accessor:"status",minWidth:100,Cell:e=>{let{row:t}=e;const{status:a}=t.original;return(0,w.jsx)(C.A,{label:a.charAt(0).toUpperCase()+a.slice(1),color:(()=>{switch(a){case"draft":return"primary";case"signed":return"warning";case"executed":return"success";default:return"default"}})(),size:"small"})}},{Header:"Signed Date",accessor:"signed_at",minWidth:120,Cell:e=>{let{row:t}=e;const{signed_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a?(0,A.pU)(a):"Not signed"})}},{Header:"Created",accessor:"created_at",minWidth:100,Cell:e=>{let{row:t}=e;const{created_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,A.pU)(a)})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const i=a.original;return(0,w.jsx)(j.A,{actions:e,metaData:i},a.id)}}];var L=a(63516),T=a(74523),V=a(23722),W=a(80644),R=a(25933),O=a(75992);const H=[{label:"New",value:"new"},{label:"Qualified",value:"qualified"},{label:"Lost",value:"lost"}],U=[{label:"Customer",value:"customer"},{label:"Supplier",value:"supplier"},{label:"Investor",value:"investor"}],z=[{label:"Prospect",value:"prospect"},{label:"Quote",value:"quote"},{label:"Won",value:"won"},{label:"Lost",value:"lost"}],F=[{label:"Draft",value:"draft"},{label:"Signed",value:"signed"},{label:"Executed",value:"executed"}],N=[{label:"Referral",value:"referral"},{label:"Website",value:"website"},{label:"Cold Call",value:"cold_call"},{label:"Social Media",value:"social_media"},{label:"Trade Show",value:"trade_show"},{label:"Advertisement",value:"advertisement"},{label:"Other",value:"other"}];var M=a(73033);const Y=M.Ik().shape({name:M.Yj().min(2,"Name must be at least 2 characters").max(255,"Name must not exceed 255 characters").required("Lead name is required"),phone:M.Yj().matches(/^\+?[1-9]\d{1,14}$/,"Please enter a valid phone number").required("Phone number is required"),email:M.Yj().email("Please enter a valid email address").optional(),source:M.Yj().required("Lead source is required"),status:M.Yj().oneOf(["new","qualified","lost"],"Invalid status").required("Status is required"),assigned_to_id:M.Yj().optional()}),D=M.Ik().shape({name:M.Yj().min(2,"Account name must be at least 2 characters").max(255,"Account name must not exceed 255 characters").required("Account name is required"),type:M.Yj().oneOf(["customer","supplier","investor"],"Invalid account type").required("Account type is required"),credit_terms_days:M.ai().min(0,"Credit terms must be a positive number").max(365,"Credit terms cannot exceed 365 days").required("Credit terms are required"),hub_id:M.Yj().optional()}),I=M.Ik().shape({name:M.Yj().min(2,"Contact name must be at least 2 characters").max(255,"Contact name must not exceed 255 characters").required("Contact name is required"),phone:M.Yj().matches(/^\+?[1-9]\d{1,14}$/,"Please enter a valid phone number").required("Phone number is required"),email:M.Yj().email("Please enter a valid email address").optional(),role:M.Yj().max(50,"Role must not exceed 50 characters").optional(),account_id:M.Yj().required("Account is required"),user_id:M.Yj().optional()}),P=M.Ik().shape({name:M.Yj().min(2,"Opportunity name must be at least 2 characters").max(255,"Opportunity name must not exceed 255 characters").required("Opportunity name is required"),account_id:M.Yj().required("Account is required"),expected_volume_mt:M.ai().min(.01,"Volume must be greater than 0").max(999999999.99,"Volume is too large").required("Expected volume is required"),expected_price_per_mt:M.ai().min(.01,"Price must be greater than 0").max(999999999.99,"Price is too large").required("Expected price is required"),stage:M.Yj().oneOf(["prospect","quote","won","lost"],"Invalid stage").required("Stage is required"),assigned_to_id:M.Yj().required("BDM assignment is required")}),$=M.Ik().shape({opportunity_id:M.Yj().required("Opportunity is required"),terms:M.Yj().min(10,"Terms must be at least 10 characters").required("Contract terms are required"),status:M.Yj().oneOf(["draft","signed","executed"],"Invalid status").required("Status is required"),signed_at:M.p6().optional().when("status",{is:e=>"signed"===e||"executed"===e,then:e=>e.required("Signed date is required when contract is signed")})}),Q=e=>{let{handleClose:t,formType:a="Save",initialValues:i,callBack:s}=e;const n=(0,c.useRef)(null),[l,d]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]);(0,c.useEffect)((()=>{h()}),[]);const h=async()=>{try{var e;const t=(null===(e=(await g.E.getBDMUsers()).results)||void 0===e?void 0:e.map((e=>({label:"".concat(e.first_name," ").concat(e.last_name),value:e.id}))))||[];p(t)}catch(t){console.error("Error fetching BDM users:",t)}},x=function(){return[{name:"name",initailValue:"",label:"Lead Name",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"phone",initailValue:"",label:"Phone Number",type:"tel",uiType:"phone",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"email",initailValue:"",label:"Email Address",type:"email",uiType:"email",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}},{name:"source",initailValue:"",label:"Lead Source",type:"select",uiType:"select",options:N,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"status",initailValue:"new",label:"Status",type:"select",uiType:"select",options:H,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"assigned_to_id",initailValue:"",label:"Assign to BDM",type:"select",uiType:"select",options:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}}]}(m),v=(0,L.Wx)({initialValues:(0,R.f6)(x),validationSchema:Y,validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>y(e)});(0,c.useEffect)((()=>{"Update"===a&&i&&v.setValues((0,R.RA)(x)(i||{}))}),[i,a]);const y=async e=>{d(!0);try{"Update"===a?(await g.E.updateLead(e,null===i||void 0===i?void 0:i.id),u.oR.success("Lead updated successfully")):(await g.E.createLead(e),u.oR.success("Lead created successfully")),v.resetForm(),s&&s(),t()}catch(n){var r;null!==(r=n.response)&&void 0!==r&&r.data&&v.setErrors(n.response.data),u.oR.error(n.message||"An error occurred")}finally{d(!1)}},f=()=>{v.resetForm(),t()};return(0,w.jsx)(T.A,{title:"Save"===a?"New Lead":"Edit Lead",onClose:f,id:(0,O.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.A,{onClick:f,disabled:l,children:"Close"}),(0,w.jsx)(o.A,{onClick:()=>v.handleSubmit(),variant:"contained",disabled:l,children:l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.A,{color:"inherit",size:20}),(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Lead":"Create Lead"})]}),children:(0,w.jsx)("form",{ref:n,onSubmit:v.handleSubmit,children:(0,w.jsx)(r.A,{sx:{width:"100%"},children:(0,w.jsx)(W.A,{formikInstance:v,formFields:x,validationSchema:Y})})})})},G=e=>{let{handleClose:t,formType:a="Save",initialValues:i,callBack:s}=e;const n=(0,c.useRef)(null),[l,d]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]);(0,c.useEffect)((()=>{h()}),[]);const h=async()=>{try{var e;const t=(null===(e=(await g.E.getHubs()).results)||void 0===e?void 0:e.map((e=>({label:e.name,value:e.id}))))||[];p(t)}catch(t){console.error("Error fetching hubs:",t)}},x=function(){return[{name:"name",initailValue:"",label:"Account Name",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"type",initailValue:"",label:"Account Type",type:"select",uiType:"select",options:U,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"credit_terms_days",initailValue:30,label:"Credit Terms (Days)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"hub_id",initailValue:"",label:"Hub",type:"select",uiType:"select",options:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}}]}(m),v=(0,L.Wx)({initialValues:(0,R.f6)(x),validationSchema:D,validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>y(e)});(0,c.useEffect)((()=>{"Update"===a&&i&&v.setValues((0,R.RA)(x)(i||{}))}),[i,a]);const y=async e=>{d(!0);try{"Update"===a?(await g.E.updateAccount(e,null===i||void 0===i?void 0:i.id),u.oR.success("Account updated successfully")):(await g.E.createAccount(e),u.oR.success("Account created successfully")),v.resetForm(),s&&s(),t()}catch(n){var r;null!==(r=n.response)&&void 0!==r&&r.data&&v.setErrors(n.response.data),u.oR.error(n.message||"An error occurred")}finally{d(!1)}},f=()=>{v.resetForm(),t()};return(0,w.jsx)(T.A,{title:"Save"===a?"New Account":"Edit Account",onClose:f,id:(0,O.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.A,{onClick:f,disabled:l,children:"Close"}),(0,w.jsx)(o.A,{onClick:()=>v.handleSubmit(),variant:"contained",disabled:l,children:l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.A,{color:"inherit",size:20}),(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Account":"Create Account"})]}),children:(0,w.jsx)("form",{ref:n,onSubmit:v.handleSubmit,children:(0,w.jsx)(r.A,{sx:{width:"100%"},children:(0,w.jsx)(W.A,{formikInstance:v,formFields:x,validationSchema:D})})})})},J=e=>{let{handleClose:t,formType:a="Save",initialValues:i,callBack:s}=e;const n=(0,c.useRef)(null),[l,d]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]),[h,x]=(0,c.useState)([]);(0,c.useEffect)((()=>{v(),y()}),[]);const v=async()=>{try{var e;const t=(null===(e=(await g.E.getAccounts({})).results)||void 0===e?void 0:e.map((e=>({label:e.name,value:e.id}))))||[];p(t)}catch(t){console.error("Error fetching accounts:",t)}},y=async()=>{try{var e;const t=(null===(e=(await g.E.getBDMUsers()).results)||void 0===e?void 0:e.filter((e=>"client"===e.role)).map((e=>({label:"".concat(e.first_name," ").concat(e.last_name),value:e.id}))))||[];x(t)}catch(t){console.error("Error fetching client users:",t)}},f=function(){return[{name:"name",initailValue:"",label:"Contact Name",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"phone",initailValue:"",label:"Phone Number",type:"tel",uiType:"phone",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"email",initailValue:"",label:"Email Address",type:"email",uiType:"email",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}},{name:"role",initailValue:"",label:"Role/Position",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}},{name:"account_id",initailValue:"",label:"Account",type:"select",uiType:"select",options:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"user_id",initailValue:"",label:"Link to BDM User",type:"select",uiType:"select",options:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}}]}(m,h),b=(0,L.Wx)({initialValues:(0,R.f6)(f),validationSchema:I,validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>C(e)});(0,c.useEffect)((()=>{"Update"===a&&i&&b.setValues((0,R.RA)(f)(i||{}))}),[i,a]);const C=async e=>{d(!0);try{"Update"===a?(await g.E.updateContact(e,null===i||void 0===i?void 0:i.id),u.oR.success("Contact updated successfully")):(await g.E.createContact(e),u.oR.success("Contact created successfully")),b.resetForm(),s&&s(),t()}catch(n){var r;null!==(r=n.response)&&void 0!==r&&r.data&&b.setErrors(n.response.data),u.oR.error(n.message||"An error occurred")}finally{d(!1)}},A=()=>{b.resetForm(),t()};return(0,w.jsx)(T.A,{title:"Save"===a?"New Contact":"Edit Contact",onClose:A,id:(0,O.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.A,{onClick:A,disabled:l,children:"Close"}),(0,w.jsx)(o.A,{onClick:()=>b.handleSubmit(),variant:"contained",disabled:l,children:l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.A,{color:"inherit",size:20}),(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Contact":"Create Contact"})]}),children:(0,w.jsx)("form",{ref:n,onSubmit:b.handleSubmit,children:(0,w.jsx)(r.A,{sx:{width:"100%"},children:(0,w.jsx)(W.A,{formikInstance:b,formFields:f,validationSchema:I})})})})},K=e=>{let{handleClose:t,formType:a="Save",initialValues:i,callBack:s}=e;const n=(0,c.useRef)(null),[l,d]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]),[h,x]=(0,c.useState)([]);(0,c.useEffect)((()=>{v(),y()}),[]);const v=async()=>{try{var e;const t=(null===(e=(await g.E.getAccounts({})).results)||void 0===e?void 0:e.map((e=>({label:e.name,value:e.id}))))||[];p(t)}catch(t){console.error("Error fetching accounts:",t)}},y=async()=>{try{var e;const t=(null===(e=(await g.E.getBDMUsers()).results)||void 0===e?void 0:e.map((e=>({label:"".concat(e.first_name," ").concat(e.last_name),value:e.id}))))||[];x(t)}catch(t){console.error("Error fetching BDM users:",t)}},f=function(){return[{name:"name",initailValue:"",label:"Opportunity Name",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:12,lg:12,xl:12},required:!0},{name:"account_id",initailValue:"",label:"Account",type:"select",uiType:"select",options:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"expected_volume_mt",initailValue:"",label:"Expected Volume (MT)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"expected_price_per_mt",initailValue:"",label:"Expected Price per MT ($)",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"stage",initailValue:"prospect",label:"Stage",type:"select",uiType:"select",options:z,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"assigned_to_id",initailValue:"",label:"Assign to BDM",type:"select",uiType:"select",options:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0}]}(m,h),b=(0,L.Wx)({initialValues:(0,R.f6)(f),validationSchema:P,validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>C(e)});(0,c.useEffect)((()=>{"Update"===a&&i&&b.setValues((0,R.RA)(f)(i||{}))}),[i,a]);const C=async e=>{d(!0);try{"Update"===a?(await g.E.updateOpportunity(e,null===i||void 0===i?void 0:i.id),u.oR.success("Opportunity updated successfully")):(await g.E.createOpportunity(e),u.oR.success("Opportunity created successfully")),b.resetForm(),s&&s(),t()}catch(n){var r;null!==(r=n.response)&&void 0!==r&&r.data&&b.setErrors(n.response.data),u.oR.error(n.message||"An error occurred")}finally{d(!1)}},A=()=>{b.resetForm(),t()};return(0,w.jsx)(T.A,{title:"Save"===a?"New Opportunity":"Edit Opportunity",onClose:A,id:(0,O.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.A,{onClick:A,disabled:l,children:"Close"}),(0,w.jsx)(o.A,{onClick:()=>b.handleSubmit(),variant:"contained",disabled:l,children:l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.A,{color:"inherit",size:20}),(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Opportunity":"Create Opportunity"})]}),children:(0,w.jsx)("form",{ref:n,onSubmit:b.handleSubmit,children:(0,w.jsx)(r.A,{sx:{width:"100%"},children:(0,w.jsx)(W.A,{formikInstance:b,formFields:f,validationSchema:P})})})})},X=e=>{let{handleClose:t,formType:a="Save",initialValues:i,callBack:s}=e;const n=(0,c.useRef)(null),[l,d]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]);(0,c.useEffect)((()=>{h()}),[]);const h=async()=>{try{var e;const t=(null===(e=(await g.E.getOpportunities({stage:"won"})).results)||void 0===e?void 0:e.map((e=>({label:e.name,value:e.id}))))||[];p(t)}catch(t){console.error("Error fetching opportunities:",t)}},x=function(){return[{name:"opportunity_id",initailValue:"",label:"Opportunity",type:"select",uiType:"select",options:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],uiBreakpoints:{xs:12,sm:12,md:12,lg:12,xl:12},required:!0},{name:"terms",initailValue:"",label:"Contract Terms",type:"text",uiType:"textarea",uiBreakpoints:{xs:12,sm:12,md:12,lg:12,xl:12},required:!0},{name:"status",initailValue:"draft",label:"Status",type:"select",uiType:"select",options:F,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"signed_at",initailValue:"",label:"Signed Date",type:"datetime-local",uiType:"datetime",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6}}]}(m),v=(0,L.Wx)({initialValues:(0,R.f6)(x),validationSchema:$,validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>y(e)});(0,c.useEffect)((()=>{"Update"===a&&i&&v.setValues((0,R.RA)(x)(i||{}))}),[i,a]);const y=async e=>{d(!0);try{"Update"===a?(await g.E.updateContract(e,null===i||void 0===i?void 0:i.id),u.oR.success("Contract updated successfully")):(await g.E.createContract(e),u.oR.success("Contract created successfully")),v.resetForm(),s&&s(),t()}catch(n){var r;null!==(r=n.response)&&void 0!==r&&r.data&&v.setErrors(n.response.data),u.oR.error(n.message||"An error occurred")}finally{d(!1)}},f=()=>{v.resetForm(),t()};return(0,w.jsx)(T.A,{title:"Save"===a?"New Contract":"Edit Contract",onClose:f,id:(0,O.A)(),ActionButtons:()=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(o.A,{onClick:f,disabled:l,children:"Close"}),(0,w.jsx)(o.A,{onClick:()=>v.handleSubmit(),variant:"contained",disabled:l,children:l?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(V.A,{color:"inherit",size:20}),(0,w.jsx)(S.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===a?"Update Contract":"Create Contract"})]}),children:(0,w.jsx)("form",{ref:n,onSubmit:v.handleSubmit,children:(0,w.jsx)(r.A,{sx:{width:"100%"},children:(0,w.jsx)(W.A,{formikInstance:v,formFields:x,validationSchema:$})})})})};var Z=a(36644);const ee={tablePreHeader:{display:"flex",alignItems:"center",gap:2,marginBottom:2}},te=()=>{(0,x.A)("CRM");const{setShowModal:e}=(0,v.k3)(),[t,a]=(0,c.useState)("leads"),[L,T]=(0,c.useState)(""),[V,W]=(0,c.useState)({}),[R,O]=(0,c.useState)(!1),[H,U]=(0,c.useState)(null),[z,F]=(0,c.useState)("Save"),[N,M]=(0,c.useState)(),[Y,D]=(0,c.useState)(),[I,P]=(0,c.useState)(),[$,te]=(0,c.useState)(),[ae,ie]=(0,c.useState)(),re=[{label:"Leads",value:"leads",count:null===N||void 0===N?void 0:N.count},{label:"Accounts",value:"accounts",count:null===Y||void 0===Y?void 0:Y.count},{label:"Contacts",value:"contacts",count:null===I||void 0===I?void 0:I.count},{label:"Opportunities",value:"opportunities",count:null===$||void 0===$?void 0:$.count},{label:"Contracts",value:"contracts",count:null===ae||void 0===ae?void 0:ae.count}];(0,c.useEffect)((()=>{se(t,V)}),[t,V]);const se=async(e,t)=>{try{O(!0);const a=L?(0,i.A)({search:L},t):t;switch(e){case"leads":const e=await g.E.getLeads(a);M(e);break;case"accounts":const t=await g.E.getAccounts(a);D(t);break;case"contacts":const i=await g.E.getContacts(a);P(i);break;case"opportunities":const r=await g.E.getOpportunities(a);te(r);break;case"contracts":const s=await g.E.getContracts(a);ie(s)}}catch(a){console.error("Error fetching ".concat(e,":"),a),u.oR.error("Failed to fetch ".concat(e))}finally{O(!1)}},ne=()=>{se(t,V)},le=()=>{e(!1),U(null)},oe=()=>{const a=[{label:"Edit",icon:(0,w.jsx)(m.A,{color:"primary"}),onClick:t=>(t=>{F("Update"),U(t),setTimeout((()=>{e(!0)}))})(t)},{label:"Delete",icon:(0,w.jsx)(d.A,{color:"error"}),onClick:e=>(async e=>{try{switch(t){case"leads":await g.E.deleteLead(e.id);break;case"accounts":await g.E.deleteAccount(e.id);break;case"contacts":await g.E.deleteContact(e.id);break;case"opportunities":await g.E.deleteOpportunity(e.id);break;case"contracts":await g.E.deleteContract(e.id)}u.oR.success("".concat(t.slice(0,-1)," deleted successfully")),ne()}catch(a){u.oR.error("Failed to delete item")}})(e)}];switch(t){case"leads":return[{label:"Qualify",icon:(0,w.jsx)(p.A,{color:"success"}),onClick:e=>{"new"===e.status?(async e=>{try{await g.E.qualifyLead(e.id),u.oR.success("Lead qualified successfully"),ne()}catch(t){u.oR.error("Failed to qualify lead")}})(e):u.oR.error("Only new leads can be qualified")}},...a];case"contracts":return[{label:"Execute",icon:(0,w.jsx)(h.A,{color:"warning"}),onClick:e=>{"signed"===e.status?(async e=>{try{await g.E.executeContract(e.id),u.oR.success("Contract executed successfully"),ne()}catch(t){u.oR.error("Failed to execute contract")}})(e):u.oR.error("Only signed contracts can be executed")}},...a];default:return a}},ce=(()=>{switch(t){case"leads":return{data:(null===N||void 0===N?void 0:N.results)||[],count:(null===N||void 0===N?void 0:N.count)||0,columnShape:(e=oe(),[{Header:"Name",accessor:"name",minWidth:150,Cell:e=>{let{row:t}=e;const{name:a}=t.original;return(0,w.jsx)(b.A,{sx:_,color:"primary",variant:"h6",children:a})}},{Header:"Phone",accessor:"phone",minWidth:130},{Header:"Email",accessor:"email",minWidth:180,Cell:e=>{let{row:t}=e;const{email:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a||"N/A"})}},{Header:"Source",accessor:"source",minWidth:100,Cell:e=>{let{row:t}=e;const{source:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12,textTransform:"capitalize"},children:a})}},{Header:"Status",accessor:"status",minWidth:100,Cell:e=>{let{row:t}=e;const{status:a}=t.original;return(0,w.jsx)(C.A,{label:a.charAt(0).toUpperCase()+a.slice(1),color:(()=>{switch(a){case"new":return"primary";case"qualified":return"success";case"lost":return"error";default:return"default"}})(),size:"small"})}},{Header:"Assigned To",accessor:"assigned_to",minWidth:150,Cell:e=>{let{row:t}=e;const{assigned_to:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:a?"".concat(a.first_name," ").concat(a.last_name):"Unassigned"})}},{Header:"Created",accessor:"created_at",minWidth:100,Cell:e=>{let{row:t}=e;const{created_at:a}=t.original;return(0,w.jsx)(S.L9,{sx:{fontSize:12},children:(0,A.pU)(a)})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:t=>{let{row:a}=t;const i=a.original;return(0,w.jsx)(j.A,{actions:e,metaData:i},a.id)}}])};case"accounts":return{data:(null===Y||void 0===Y?void 0:Y.results)||[],count:(null===Y||void 0===Y?void 0:Y.count)||0,columnShape:k(oe())};case"contacts":return{data:(null===I||void 0===I?void 0:I.results)||[],count:(null===I||void 0===I?void 0:I.count)||0,columnShape:q(oe())};case"opportunities":return{data:(null===$||void 0===$?void 0:$.results)||[],count:(null===$||void 0===$?void 0:$.count)||0,columnShape:E(oe())};case"contracts":return{data:(null===ae||void 0===ae?void 0:ae.results)||[],count:(null===ae||void 0===ae?void 0:ae.count)||0,columnShape:B(oe())};default:return{data:[],count:0,columnShape:[]}}var e})();return(0,w.jsxs)(r.A,{pt:2,pb:4,children:[(0,w.jsx)(r.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,w.jsx)(s.A,{value:t,onChange:(e,t)=>{a(t),T(""),W({})},"aria-label":"CRM tabs",variant:"scrollable",scrollButtons:"auto",children:re.map((e=>(0,w.jsx)(n.A,{label:(0,w.jsx)(l.A,{badgeContent:e.count,color:"primary",invisible:!e.count,children:e.label}),value:e.value},e.value)))})}),(0,w.jsxs)(r.A,{sx:ee.tablePreHeader,children:[(0,w.jsx)(y.A,{value:L,onChange:e=>{const a=e.target.value;T(a);const r=setTimeout((()=>{se(t,(0,i.A)((0,i.A)({},V),{},{search:a}))}),500);return()=>clearTimeout(r)},type:"text",placeholder:"Search ".concat(t,"...")}),(0,w.jsxs)(o.A,{sx:{marginLeft:"auto"},variant:"contained",onClick:()=>{F("Save"),U(null),e(!0)},children:["Create ",t.charAt(0).toUpperCase()+t.slice(1,-1)]})]}),(0,w.jsx)(f.A,{columnShape:ce.columnShape,data:ce.data,dataCount:ce.count,pageInitialState:{pageSize:Z.hk,pageIndex:0},setPageIndex:e=>W((0,i.A)((0,i.A)({},V),{},{page:e})),pageIndex:(null===V||void 0===V?void 0:V.page)||1,setPageSize:e=>W((0,i.A)((0,i.A)({},V),{},{page_size:e})),loading:R}),(()=>{switch(t){case"leads":return(0,w.jsx)(Q,{callBack:ne,formType:z,handleClose:le,initialValues:H});case"accounts":return(0,w.jsx)(G,{callBack:ne,formType:z,handleClose:le,initialValues:H});case"contacts":return(0,w.jsx)(J,{callBack:ne,formType:z,handleClose:le,initialValues:H});case"opportunities":return(0,w.jsx)(K,{callBack:ne,formType:z,handleClose:le,initialValues:H});case"contracts":return(0,w.jsx)(X,{callBack:ne,formType:z,handleClose:le,initialValues:H});default:return null}})()]})}}}]);
//# sourceMappingURL=5712.4a6a9320.chunk.js.map