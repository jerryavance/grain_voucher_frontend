"use strict";(self.webpackChunkgrain_voucher_system=self.webpackChunkgrain_voucher_system||[]).push([[6164],{10183:(e,a,t)=>{t.d(a,{O:()=>r});var n=t(56629);const r={getTrades:async e=>n.A.get("trade/trades/",{params:e}).then((e=>e.data)),getTradeDetails:async e=>n.A.get("trade/trades/".concat(e,"/")).then((e=>e.data)),createTrade:async e=>n.A.post("trade/trades/",e).then((e=>e.data)),updateTrade:async(e,a)=>n.A.patch("trade/trades/".concat(a,"/"),e).then((e=>e.data)),deleteTrade:async e=>n.A.delete("trade/trades/".concat(e,"/")).then((e=>e.data)),progressStatus:async(e,a)=>n.A.post("trade/trades/".concat(e,"/progress_status/"),a).then((e=>e.data)),quickApprove:async(e,a)=>n.A.post("trade/trades/".concat(e,"/quick_approve/"),a).then((e=>e.data)),quickReject:async(e,a)=>n.A.post("trade/trades/".concat(e,"/quick_reject/"),a).then((e=>e.data)),allocateVouchers:async(e,a)=>n.A.post("trade/trades/".concat(e,"/allocate_vouchers/"),a).then((e=>e.data)),createDeliveryBatch:async(e,a)=>n.A.post("trade/trades/".concat(e,"/create_delivery_batch/"),a).then((e=>e.data)),getDeliveryProgress:async e=>n.A.get("trade/trades/".concat(e,"/delivery_progress/")).then((e=>e.data)),markCompleted:async e=>n.A.post("trade/trades/".concat(e,"/mark_completed/")).then((e=>e.data)),getInvoicesAndPayments:async e=>n.A.get("trade/trades/".concat(e,"/invoices_and_payments/")).then((e=>e.data)),getPaymentInfo:async e=>n.A.get("trade/trades/".concat(e,"/payment_info/")).then((e=>e.data)),getCostBreakdown:async e=>n.A.get("trade/trades/".concat(e,"/cost_breakdown/")).then((e=>e.data)),getDeliveryStatusCheck:async e=>n.A.get("trade/trades/".concat(e,"/delivery_status_check/")).then((e=>e.data)),getDashboardStats:async e=>n.A.get("trade/trades/dashboard_stats/",{params:e}).then((e=>e.data)),getFinancingAllocations:async e=>n.A.get("trade/financing/",{params:e}).then((e=>e.data)),createFinancingAllocation:async e=>n.A.post("trade/financing/",e).then((e=>e.data)),updateFinancingAllocation:async(e,a)=>n.A.patch("trade/financing/".concat(a,"/"),e).then((e=>e.data)),deleteFinancingAllocation:async e=>n.A.delete("trade/financing/".concat(e,"/")).then((e=>e.data)),getLoans:async e=>n.A.get("trade/loans/",{params:e}).then((e=>e.data)),createLoan:async e=>n.A.post("trade/loans/",e).then((e=>e.data)),updateLoan:async(e,a)=>n.A.patch("trade/loans/".concat(a,"/"),e).then((e=>e.data)),repayLoan:async(e,a)=>n.A.post("trade/loans/".concat(e,"/repay/"),a).then((e=>e.data)),getTradeCosts:async e=>n.A.get("trade/costs/",{params:e}).then((e=>e.data)),createTradeCost:async e=>n.A.post("trade/costs/",e).then((e=>e.data)),updateTradeCost:async(e,a)=>n.A.patch("trade/costs/".concat(a,"/"),e).then((e=>e.data)),deleteTradeCost:async e=>n.A.delete("trade/costs/".concat(e,"/")).then((e=>e.data)),getBrokerages:async e=>n.A.get("trade/brokerages/",{params:e}).then((e=>e.data)),createBrokerage:async e=>n.A.post("trade/brokerages/",e).then((e=>e.data)),updateBrokerage:async(e,a)=>n.A.patch("trade/brokerages/".concat(a,"/"),e).then((e=>e.data)),deleteBrokerage:async e=>n.A.delete("trade/brokerages/".concat(e,"/")).then((e=>e.data)),getMyCommissions:async()=>n.A.get("trade/brokerages/my_commissions/").then((e=>e.data)),getGRNs:async e=>n.A.get("trade/grns/",{params:e}).then((e=>e.data)),getGRNDetails:async e=>n.A.get("trade/grns/".concat(e,"/")).then((e=>e.data)),createGRN:async e=>n.A.post("trade/grns/",e).then((e=>e.data)),updateGRN:async(e,a)=>n.A.patch("trade/grns/".concat(a,"/"),e).then((e=>e.data)),getGRNInvoiceStatus:async e=>n.A.get("trade/grns/".concat(e,"/invoice_status/")).then((e=>e.data)),getGRNsByTrade:async e=>n.A.get("trade/grns/by_trade/",{params:{trade_id:e}}).then((e=>e.data)),getBuyers:async e=>n.A.get("crm/accounts/",{params:{type:"customer",search:e,page_size:50}}).then((e=>e.data)),getSuppliers:async e=>n.A.get("auth/users/",{params:{role:"farmer",search:e,page_size:50}}).then((e=>e.data)),getGrainTypes:async e=>n.A.get("vouchers/grain-types/",{params:{search:e,page_size:50}}).then((e=>e.data)),getQualityGrades:async e=>n.A.get("vouchers/quality-grades/",{params:{search:e,page_size:50}}).then((e=>e.data)),getHubs:async e=>n.A.get("hubs/",{params:{search:e,page_size:50}}).then((e=>e.data)),getAgents:async e=>n.A.get("auth/users/",{params:{role__in:"bdm,agent",search:e,page_size:50}}).then((e=>e.data)),getInvestorAccounts:async e=>n.A.get("investors/accounts/",{params:{search:e,page_size:50}}).then((e=>e.data))}},15909:(e,a,t)=>{t.d(a,{W:()=>r});var n=t(56629);const r={getPayments:async e=>n.A.get("accounting/payments/",{params:e}).then((e=>e.data)),getPaymentDetails:async e=>n.A.get("accounting/payments/".concat(e,"/")).then((e=>e.data)),createPayment:async e=>n.A.post("accounting/payments/",e).then((e=>e.data)),updatePayment:async(e,a)=>n.A.patch("accounting/payments/".concat(a,"/"),e).then((e=>e.data)),deletePayment:async e=>n.A.delete("accounting/payments/".concat(e,"/")).then((e=>e.data)),reconcilePayment:async e=>n.A.post("accounting/payments/".concat(e,"/reconcile/")).then((e=>e.data))}},54189:(e,a,t)=>{t.d(a,{F:()=>r});var n=t(56629);const r={getJournalEntries:async e=>n.A.get("accounting/journal-entries/",{params:e}).then((e=>e.data)),getJournalEntryDetails:async e=>n.A.get("accounting/journal-entries/".concat(e,"/")).then((e=>e.data)),createJournalEntry:async e=>n.A.post("accounting/journal-entries/",e).then((e=>e.data)),updateJournalEntry:async(e,a)=>n.A.patch("accounting/journal-entries/".concat(a,"/"),e).then((e=>e.data)),deleteJournalEntry:async e=>n.A.delete("accounting/journal-entries/".concat(e,"/")).then((e=>e.data)),reverseJournalEntry:async(e,a)=>n.A.post("accounting/journal-entries/".concat(e,"/reverse/"),a).then((e=>e.data)),getTrialBalance:async e=>n.A.get("accounting/journal-entries/trial_balance/",{params:e}).then((e=>e.data))}},85742:(e,a,t)=>{var n=t(24994);a.A=void 0;var r=n(t(40039)),s=t(70579);a.A=(0,r.default)((0,s.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo")},86164:(e,a,t)=>{t.r(a),t.d(a,{default:()=>I});var n=t(89379),r=t(96446),s=t(8302),c=t(65043),i=t(23768),o=t(63471),d=t(95540),l=t(85742),u=t(13194),p=t(8433),y=t(54189),m=t(64093),g=t(61408),h=t(85865),A=t(73216),v=t(46055),b=t(23817),x=t(42438),_=t(70579);const k={cursor:"pointer","&:hover":{textDecoration:"underline",fontWeight:"bold"}},j=e=>{let{id:a,number:t}=e;const n=(0,A.Zp)();return(0,_.jsx)(h.A,{sx:k,color:"primary",variant:"h6",onClick:()=>n("/admin/accounting/journal-entries/details/".concat(a)),children:t})},f=e=>[{Header:"Entry Number",accessor:"entry_number",minWidth:150,Cell:e=>{let{row:a}=e;return(0,_.jsx)(j,{id:a.original.id,number:a.original.entry_number})}},{Header:"Type",accessor:"entry_type_display",minWidth:120},{Header:"Date",accessor:"entry_date",minWidth:120,Cell:e=>{let{value:a}=e;return(0,v.pU)(a)}},{Header:"Debit Account",accessor:"debit_account",minWidth:150},{Header:"Credit Account",accessor:"credit_account",minWidth:150},{Header:"Amount",accessor:"amount",minWidth:120},{Header:"Description",accessor:"description",minWidth:200},{Header:"Reversed",accessor:"is_reversed",minWidth:100,Cell:e=>{let{value:a}=e;return(0,_.jsx)(x.L9,{children:a?"Yes":"No"})}},{Header:"Action",accessor:"action",minWidth:100,maxWidth:100,Cell:a=>{let{row:t}=a;return(0,_.jsx)(b.A,{actions:e,metaData:t.original},t.id)}}];var C=t(63516),S=t(74523),E=t(23722),T=t(80644),q=t(25933),B=t(75992);const R=[{value:"sale",label:"Sale"},{value:"payment",label:"Payment Received"},{value:"purchase",label:"Purchase/COGS"},{value:"expense",label:"Expense"},{value:"adjustment",label:"Adjustment"},{value:"commission",label:"Commission Expense"},{value:"deposit",label:"Farmer Deposit"},{value:"redemption",label:"Voucher Redemption"}];var D=t(73033);const w=()=>D.Ik().shape({entry_type:D.Yj().required("Entry type is required"),date:D.p6().required("Date is required"),debit_account:D.Yj().required("Debit account is required"),credit_account:D.Yj().required("Credit account is required"),amount:D.ai().min(.01,"Amount must be greater than 0").required(),description:D.Yj().required("Description is required")});var J=t(10183),P=t(90531),V=t(15909);const F=e=>{let{handleClose:a,formType:t="Save",initialValues:n,callBack:o}=e;const d=(0,c.useRef)(null),[l,u]=(0,c.useState)(!1),[p,m]=(0,c.useState)([]),[g,h]=(0,c.useState)([]),[A,v]=(0,c.useState)([]);(0,c.useEffect)((()=>{J.O.getTrades({}).then((e=>m(e.results.map((e=>({value:e.id,label:e.trade_number})))))),P.p.getInvoices({}).then((e=>h(e.results.map((e=>({value:e.id,label:e.invoice_number})))))),V.W.getPayments({}).then((e=>v(e.results.map((e=>({value:e.id,label:e.payment_number}))))))}),[]);const b=(e=>{const{trades:a,invoices:t,payments:n}=e;return[{name:"entry_type",initailValue:"adjustment",label:"Entry Type",type:"select",uiType:"select",options:R,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"date",initailValue:"",label:"Date",uiType:"date",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"debit_account",initailValue:"",label:"Debit Account",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"credit_account",initailValue:"",label:"Credit Account",type:"text",uiType:"text",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"amount",initailValue:0,label:"Amount",type:"number",uiType:"number",uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!0},{name:"related_trade_id",initailValue:"",label:"Related Trade",type:"select",uiType:"select",options:a,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!1},{name:"related_invoice_id",initailValue:"",label:"Related Invoice",type:"select",uiType:"select",options:t,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!1},{name:"related_payment_id",initailValue:"",label:"Related Payment",type:"select",uiType:"select",options:n,uiBreakpoints:{xs:12,sm:12,md:6,lg:6,xl:6},required:!1},{name:"description",initailValue:"",label:"Description",type:"text",uiType:"text",uiBreakpoints:{xs:12},required:!0},{name:"notes",initailValue:"",label:"Notes",type:"textarea",uiType:"textarea",uiBreakpoints:{xs:12}}]})({trades:p,invoices:g,payments:A}),k=(0,C.Wx)({initialValues:(0,q.f6)(b),validationSchema:w(),validateOnChange:!1,validateOnMount:!1,validateOnBlur:!1,enableReinitialize:!0,onSubmit:e=>j(e)});(0,c.useEffect)((()=>{"Update"===t&&n&&k.setValues((0,q.RA)(b)(n||{}))}),[n,t]);const j=async e=>{u(!0);try{"Update"===t?(await y.F.updateJournalEntry(e,n.id),i.oR.success("Journal entry updated successfully")):(await y.F.createJournalEntry(e),i.oR.success("Journal entry created successfully")),k.resetForm(),o&&o(),a()}catch(s){var r;null!==(r=s.response)&&void 0!==r&&r.data&&k.setErrors(s.response.data),i.oR.error(s.message||"An error occurred")}finally{u(!1)}},f=()=>{k.resetForm(),a()},D=()=>{k.handleSubmit()};return(0,_.jsx)(S.A,{title:"Save"===t?"New Journal Entry":"Edit Journal Entry",onClose:f,id:(0,B.A)(),ActionButtons:()=>(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(s.A,{onClick:f,disabled:l,children:"Close"}),(0,_.jsx)(s.A,{onClick:D,type:"button",variant:"contained",disabled:l,children:l?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(E.A,{color:"inherit",size:20})," ",(0,_.jsx)(x.L9,{style:{marginLeft:"0.5rem"},color:"primary",children:"Loading..."})]}):"Update"===t?"Update Entry":"Create Entry"})]}),children:(0,_.jsx)("form",{ref:d,onSubmit:e=>{e.preventDefault(),j(k.values)},encType:"multipart/form-data",children:(0,_.jsx)(r.A,{sx:{width:"100%"},children:(0,_.jsx)(T.A,{others:{sx:{marginBottom:"0rem"}},formikInstance:k,formFields:b,validationSchema:w()})})})})};var z=t(36644);const W={tablePreHeader:{display:"flex",alignItems:"center",gap:2,marginBottom:2}},I=()=>{(0,u.A)("Journal Entries");const{setShowModal:e}=(0,p.k3)(),[a,t]=(0,c.useState)(null),[h,A]=(0,c.useState)("Save"),[v,b]=(0,c.useState)(""),[x,k]=(0,c.useState)(),[j,C]=(0,c.useState)(null),[S,E]=(0,c.useState)(!1);(0,c.useEffect)((()=>{T(j)}),[j]);const T=async e=>{try{E(!0);const a=await y.F.getJournalEntries(e);k(a),E(!1)}catch(a){E(!1),console.error("Error fetching Journal Entries:",a)}},q=()=>{T(j)},B=[{label:"Edit",icon:(0,_.jsx)(d.A,{color:"primary"}),onClick:a=>{A("Update"),t(a),setTimeout((()=>e(!0)),0)}},{label:"Reverse",icon:(0,_.jsx)(l.A,{color:"warning"}),onClick:async e=>{try{await y.F.reverseJournalEntry(e.id,{reason:"Reversal requested"}),i.oR.success("Journal entry reversed successfully"),q()}catch(a){i.oR.error("Something went wrong")}}},{label:"Delete",icon:(0,_.jsx)(o.A,{color:"error"}),onClick:async e=>{try{await y.F.deleteJournalEntry(e.id),i.oR.success("Journal entry deleted successfully"),q()}catch(a){i.oR.error("Something went wrong")}}}];return(0,_.jsxs)(r.A,{pt:2,pb:4,children:[(0,_.jsxs)(r.A,{sx:W.tablePreHeader,children:[(0,_.jsx)(m.A,{value:v,onChange:e=>{const a=e.target.value;b(a),C((0,n.A)((0,n.A)({},j),{},{search:a}))},type:"text",placeholder:"Search entry..."}),(0,_.jsx)(s.A,{sx:{marginLeft:"auto"},variant:"contained",onClick:()=>{A("Save"),t(null),e(!0)},children:"Create Entry"})]}),(0,_.jsx)(g.A,{columnShape:f(B),data:(null===x||void 0===x?void 0:x.results)||[],dataCount:(null===x||void 0===x?void 0:x.count)||0,pageInitialState:{pageSize:z.hk,pageIndex:0},setPageIndex:e=>C((0,n.A)((0,n.A)({},j),{},{page:e})),pageIndex:(null===j||void 0===j?void 0:j.page)||1,setPageSize:e=>C((0,n.A)((0,n.A)({},j),{},{page_size:e})),loading:S}),(0,_.jsx)(F,{callBack:q,formType:h,handleClose:()=>{e(!1)},initialValues:a||{}})]})}},95540:(e,a,t)=>{var n=t(24994);a.A=void 0;var r=n(t(40039)),s=t(70579);a.A=(0,r.default)((0,s.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit")}}]);
//# sourceMappingURL=6164.13f818d4.chunk.js.map