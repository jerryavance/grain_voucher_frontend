"use strict";(self.webpackChunkgrain_voucher_system=self.webpackChunkgrain_voucher_system||[]).push([[4159],{64159:(e,s,r)=>{r.r(s),r.d(s,{default:()=>R});var t=r(89379),a=r(26240),n=r(79285),i=r(96446),o=r(65043),l=r(61408),c=r(64093),u=r(13194),d=r(23768),h=r(36644),p=r(98606),m=r(91794),b=r(66734),g=r(70579);const v=(0,b.A)((0,g.jsx)("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"}),"PersonRemove");var x=r(3632),A=r(69974),w=r(6905),j=r(42438),f=r(23817),y=r(46149),S=r(66925);const _=e=>{const{handleMembershipStatus:s,isHubAdmin:r,isMobile:t}=e,a=e=>{switch(null===e||void 0===e?void 0:e.toLowerCase()){case"approved":case"accepted":case"active":return"#4caf50";case"pending":return"#ff9800";case"rejected":return"#f44336";default:return"#666"}};return[{Header:"Member",accessor:e=>e.user.name,minWidth:t?200:250,Cell:e=>{let{row:s}=e;const r=s.original,{user:a}=r;return(0,g.jsxs)(w.A,{alignItems:"center",children:[(0,g.jsx)(y.A,{src:"/static/avatar/001-man.svg",sx:{width:t?32:35,height:t?32:35}}),(0,g.jsxs)(w.A,{flexDirection:"column",ml:t?1.5:2,children:[(0,g.jsx)(j.H6,{className:"mainColor semiBold",sx:{fontSize:t?"0.85rem":"1rem",lineHeight:1.2},children:a.name}),(0,g.jsx)(j.lX,{color:"text.disabled",sx:{fontSize:t?"0.7rem":"0.75rem"},children:(0,S.Zr)(r.role||"farmer")})]})]})}},{Header:"Contact",accessor:e=>e.user.phone_number,minWidth:t?140:150,Cell:e=>{let{row:s}=e;const r=s.original.user;return(0,g.jsx)(w.A,{flexDirection:"column",children:r.phone_number&&(0,g.jsxs)(w.A,{alignItems:"center",mb:.5,children:[(0,g.jsx)(A.A,{sx:{fontSize:t?12:14,mr:.5,color:"#666"}}),(0,g.jsx)(j.lX,{sx:{fontSize:t?"0.7rem":"0.75rem"},children:t?r.phone_number.replace("+256","0"):r.phone_number})]})})}},{Header:"Hub",accessor:e=>e.hub.name,minWidth:150,Cell:e=>{let{row:s}=e;const r=s.original.hub;return(0,g.jsxs)(w.A,{flexDirection:"column",children:[(0,g.jsx)(j.H6,{className:"semiBold",sx:{fontSize:"0.9rem"},children:r.name}),(0,g.jsx)(j.lX,{color:"text.disabled",sx:{fontSize:"0.7rem"},children:r.location.length>20?"".concat(r.location.substring(0,20),"..."):r.location})]})}},{Header:"Status",accessor:e=>e.status,minWidth:t?100:120,Cell:e=>{let{value:s,row:r}=e;const n=r.original;return(0,g.jsxs)(w.A,{flexDirection:"column",alignItems:"flex-start",children:[(0,g.jsx)("span",{style:{padding:t?"3px 6px":"4px 10px",borderRadius:"4px",fontSize:t?"0.65rem":"0.75rem",fontWeight:600,color:"white",backgroundColor:a(s),textAlign:"center",display:"inline-block",minWidth:t?"60px":"70px"},children:(0,S.Zr)(s)}),n.requested_at&&!t&&(0,g.jsxs)(j.lX,{color:"text.disabled",mt:.5,children:["Applied: ",(i=n.requested_at,t?new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"2-digit"}):new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]});var i}},...r&&!t?[{Header:"Application Reason",accessor:e=>e.reason,minWidth:180,Cell:e=>{let{value:s}=e;return(0,g.jsx)(j.lX,{sx:{maxWidth:160,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.75rem"},title:s,children:s||"No reason provided"})}}]:[],...r?[{Header:"Actions",accessor:"id",minWidth:t?80:100,maxWidth:t?80:120,Cell:e=>{let{row:t}=e;const a=t.original,n=(e=>{if(!r)return[];const t=[];return"pending"===e.status&&t.push({label:"Approve Application",icon:(0,g.jsx)(p.A,{color:"success"}),onClick:e=>s(e,"approved")},{label:"Reject Application",icon:(0,g.jsx)(m.A,{color:"error"}),onClick:e=>s(e,"rejected")}),"active"===e.status&&("member"!==e.role&&"farmer"!==e.role||t.push({label:"Assign as Agent",icon:(0,g.jsx)(p.A,{color:"success"}),onClick:e=>s(e,"assign_agent")}),"agent"===e.role&&t.push({label:"Unassign Agent",icon:(0,g.jsx)(v,{color:"error"}),onClick:e=>s(e,"unassign_agent")}),t.push({label:"Remove from Hub",icon:(0,g.jsx)(v,{color:"error"}),onClick:e=>s(e,"remove")})),t.push({label:"View Details",icon:(0,g.jsx)(x.A,{}),onClick:e=>{console.log("View user details:",e.user)}}),t})(a);return 0===n.length?(0,g.jsx)(j.lX,{children:"-"}):(0,g.jsx)(f.A,{actions:n,metaData:a},a.id)}}]:[]]};var C=r(57354),k=r(64220),M=r(32672);const R=e=>{var s,r;let{hubId:p}=e;(0,u.A)("Hub Membership");const m=(0,a.A)(),b=(0,n.A)(m.breakpoints.down("md")),{user:v}=(0,M.A)(),[x,A]=(0,o.useState)([]),[w,j]=(0,o.useState)({search:"",page:1,page_size:h.hk,hub_id:p}),[f,y]=(0,o.useState)(!1),[S,R]=(0,o.useState)({open:!1,applicant:null}),H="hub_admin"===(null===v||void 0===v?void 0:v.role),z="super_admin"===(null===v||void 0===v?void 0:v.role);(0,o.useEffect)((()=>{W()}),[null===w||void 0===w?void 0:w.page,null===w||void 0===w?void 0:w.page_size,null===w||void 0===w?void 0:w.hub_id]);const W=async()=>{try{y(!0);const e=await k.S.getHubMemberships(w);let s=[];Array.isArray(e)?s=e:e&&Array.isArray(e.results)&&(s=e.results),A(s)}catch(r){var e,s;console.error("Error fetching memberships:",r),404===(null===r||void 0===r||null===(e=r.response)||void 0===e?void 0:e.status)?d.oR.error("No memberships found or you don't have access to view them"):403===(null===r||void 0===r||null===(s=r.response)||void 0===s?void 0:s.status)?d.oR.error("You don't have permission to view these memberships"):d.oR.error("Failed to load memberships"),A([])}finally{y(!1)}},D=async(e,s)=>{try{"approved"===s?(await k.S.approveMembership(e.id,{status:"active",notes:"Approved by hub admin"}),d.oR.success("".concat(e.user.name,"'s application approved"))):"rejected"===s?(await k.S.rejectMembership(e.id,"Rejected by hub admin"),d.oR.success("".concat(e.user.name,"'s application rejected"))):"remove"===s?(await k.S.deleteMembership(e.id),d.oR.success("".concat(e.user.name," removed from hub"))):"assign_agent"===s?(await k.S.updateMembershipRole(e.id,"agent"),d.oR.success("".concat(e.user.name," assigned as agent"))):"unassign_agent"===s&&(await k.S.updateMembershipRole(e.id,"farmer"),d.oR.success("".concat(e.user.name," unassigned as agent"))),W()}catch(i){var r,t,a,n;const e=(null===i||void 0===i||null===(r=i.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.detail)||(null===i||void 0===i||null===(a=i.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||"Something went wrong";d.oR.error(e)}},I=x.filter((e=>{var s,r;if(null===w||void 0===w||!w.search)return!0;const t=String(w.search).toLowerCase(),a=(null===(s=e.user)||void 0===s?void 0:s.name)||"",n=(null===(r=e.user)||void 0===r?void 0:r.phone_number)||"";return a.toLowerCase().includes(t)||n.includes(t)})),X=e=>{j((0,t.A)((0,t.A)({},w),{},{search:e,page:1})),setTimeout((()=>{W()}),300)};return H||z?(0,g.jsxs)(i.A,{pb:2,children:[(0,g.jsx)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:b?"stretch":"center",flexDirection:b?"column":"row",gap:b?2:0,marginBottom:2},children:(0,g.jsx)(c.A,{onBlur:e=>X(e.target.value),onChange:e=>X(e.target.value),type:"text",placeholder:"Search members by name or phone...",sx:{width:b?"100%":"auto"}})}),(0,g.jsx)(i.A,{sx:{width:"100%",overflowX:"auto",WebkitOverflowScrolling:"touch","& .MuiTableContainer-root":{maxWidth:"100%"},"& table":{minWidth:b?"800px":"100%"},"&::-webkit-scrollbar":{height:"6px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",borderRadius:"3px","&:hover":{backgroundColor:"#a8a8a8"}}},children:(0,g.jsx)(l.A,{columnShape:_({handleMembershipStatus:D,isHubAdmin:H||z,isMobile:b}),data:I,dataCount:I.length,pageInitialState:{pageSize:w.page_size,pageIndex:w.page-1},setPageIndex:e=>j((0,t.A)((0,t.A)({},w),{},{page:e+1})),pageIndex:w.page-1,setPageSize:e=>j((0,t.A)((0,t.A)({},w),{},{page_size:e,page:1})),loading:f})}),(0,g.jsx)(C.A,{open:S.open,handleClose:()=>R({open:!1,applicant:null}),title:"Reject Application",text:"Are you sure you want to reject ".concat((null===(s=S.applicant)||void 0===s||null===(r=s.user)||void 0===r?void 0:r.name)||"this"," application?"),handleOk:()=>{S.applicant&&(D(S.applicant,"rejected"),R({open:!1,applicant:null}))}})]}):(0,g.jsxs)(i.A,{p:3,textAlign:"center",children:[(0,g.jsx)("h3",{children:"Access Denied"}),(0,g.jsx)("p",{children:"Only hub administrators can view membership details."})]})}},64220:(e,s,r)=>{r.d(s,{S:()=>a});var t=r(56629);const a=new class{async getHubMemberships(e){return(await t.A.get("/hubs/hubs/memberships/",{params:e})).data}async approveMembership(e,s){return(await t.A.post("/hubs/hubs/memberships/".concat(e,"/approve/"),s)).data}async rejectMembership(e,s){return(await t.A.post("/hubs/hubs/memberships/".concat(e,"/reject/"),{status:"rejected",notes:s})).data}async deleteMembership(e){await t.A.delete("/hubs/hubs/memberships/".concat(e,"/"))}async requestMembership(e){return(await t.A.post("/hubs/hubs/memberships/request_membership/",e)).data}async leaveMembership(e){return(await t.A.post("/hubs/hubs/memberships/".concat(e,"/leave/"))).data}async checkHubMembership(e){try{return(await this.getHubMemberships({hub_id:e})).find((s=>"string"===typeof s.hub?s.hub===e:"object"===typeof s.hub&&null!==s.hub&&"id"in s.hub&&s.hub.id===e))||null}catch(s){return console.error("Error checking hub membership:",s),null}}async updateMembershipRole(e,s){return(await t.A.patch("/hubs/hubs/memberships/".concat(e,"/"),{role:s})).data}async assignAgent(e,s){await t.A.post("/authentication/users/assign_agent/",{user_id:e,hub_id:s})}async unassignAgent(e,s){await t.A.post("/authentication/users/unassign_agent/",{user_id:e,hub_id:s})}}}}]);
//# sourceMappingURL=4159.8aa03512.chunk.js.map